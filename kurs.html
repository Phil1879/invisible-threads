<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ä—Å "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏"</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItCR0LDRgtGM0LrRltCy0YHRjNC60ZYg0LTQuNGA0LXQutGC0LjQstC4IiwKICAic2hvcnRfbmFtZSI6ICLQlNC40YDQtdC60YLQuNCy0LgiLAogICJkZXNjcmlwdGlvbiI6ICLQn9GB0LjRhdC+0LvQvtCz0ZbRh9C90LjQuSDQutGD0YDRgSDQt9CyINCy0LjQstGH0LXQvdC90Y8g0YIg0L/RgNC+0YDQvtCx0LrQuCDQsdCw0YLRjNC60ZbQstGB0YzQutC40YUg0LTQuNGA0LXQutGC0LjQsiIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImh0dHBzOi8vcmVzMi53ZWJsaXVtLnNpdGUvcmVzLzY1NmUxNWQyOWEyZWIzMDAwZjlhMTYyZC82NTZmMDIzZmYwMjc5YjAwMGY3Yjk0MWJfb3B0aW1pemVkXzI2Mi53ZWJwIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS93ZWJwIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL3JlczIud2VibGl1bS5zaXRlL3Jlcy82NTZlMTVkMjlhMmViMzAwMGY5YTE2MmQvNjU2ZjAyM2ZmMDI3OWIwMDBmN2I5NDFiX29wdGltaXplZF8yNjIud2VicCIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvd2VicCIKICAgIH0KICBdCn0=">
    <link rel="apple-touch-icon" href="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 12px; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .ai-chat { max-height: 400px; overflow-y: auto; }
        .message { margin-bottom: 12px; padding: 12px; border-radius: 8px; animation: slideIn 0.3s ease-out; }
        .message.user { background: #e0f2fe; text-align: right; margin-left: 20%; }
        .message.assistant { background: #f3f4f6; margin-right: 20%; }
        .message.system { background: #fef3c7; text-align: center; font-size: 0.875rem; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media print {
            body * { visibility: hidden; }
            #certificate, #certificate * { visibility: visible; }
            #certificate { position: absolute; left: 0; top: 0; }
        }
        .certificate-frame {
            border: 20px solid;
            border-image: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%) 1;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3), inset 0 0 0 10px white;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 6rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.05);
            pointer-events: none;
            white-space: nowrap;
            z-index: 1;
        }
    </style>
</head>
<body class="bg-gray-50">

<div id="screen-register" class="min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-10 fade-in">
        <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-32 h-32 mx-auto mb-6 object-contain">
        <h1 class="text-2xl font-black text-center mb-1 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏:<br>–Ω–µ–≤–∏–¥–∏–º—ñ –Ω–∏—Ç–∫–∏</h1>
        <h2 class="text-2xl font-bold text-center mb-2 mt-4">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
        <p class="text-gray-600 text-center mb-6">–°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –¥–ª—è —Å—Ç–∞—Ä—Ç—É</p>
        <div class="space-y-4">
            <input type="text" id="register-name" placeholder="–í–∞—à–µ —ñ–º'—è" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <input type="email" id="register-email" placeholder="Email" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <input type="password" id="register-password" placeholder="–ü–∞—Ä–æ–ª—å (–º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤)" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <input type="password" id="register-password-confirm" placeholder="–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <button onclick="register()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-xl hover:shadow-xl transition">
                –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å
            </button>
        </div>
        <p class="text-center text-sm text-gray-500 mt-4">–í–∂–µ —î –∫–æ–¥? <span class="text-blue-600 cursor-pointer hover:underline" onclick="showScreen('login')">–£–≤—ñ–π—Ç–∏</span></p>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <p class="text-xs text-gray-400 text-center mb-3">–†–µ—î—Å—Ç—Ä—É—é—á–∏—Å—å, –≤–∏ –ø–æ–≥–æ–¥–∂—É—î—Ç–µ—Å—è –∑:</p>
            <div class="flex flex-col gap-2">
                <button onclick="showLegalDoc('privacy')" class="text-xs text-blue-600 hover:underline">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</button>
                <button onclick="showLegalDoc('disclaimer')" class="text-xs text-blue-600 hover:underline">–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ</button>
                <button onclick="showLegalDoc('terms')" class="text-xs text-blue-600 hover:underline">–î–æ–≥–æ–≤—ñ—Ä –ø—É–±–ª—ñ—á–Ω–æ—ó –æ—Ñ–µ—Ä—Ç–∏</button>
            </div>
        </div>
    </div>
</div>

<div id="modal-legal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-6 z-50" onclick="if(event.target === this) closeLegalDoc()">
    <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto p-8 fade-in">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-black text-gray-800" id="legal-title">–î–æ–∫—É–º–µ–Ω—Ç</h2>
            <button onclick="closeLegalDoc()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
        </div>
        <div id="legal-content" class="prose max-w-none text-gray-700"></div>
        <button onclick="closeLegalDoc()" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
</div>

<div id="screen-login" class="hidden min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-10 fade-in">
        <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-32 h-32 mx-auto mb-6 object-contain">
        <h1 class="text-2xl font-black text-center mb-1 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏:<br>–Ω–µ–≤–∏–¥–∏–º—ñ –Ω–∏—Ç–∫–∏</h1>
        <h2 class="text-2xl font-bold text-center mb-2 mt-4">–í—Ö—ñ–¥</h2>
        <p class="text-gray-600 text-center mb-6">–í–≤–µ–¥—ñ—Ç—å email —Ç–∞ –ø–∞—Ä–æ–ª—å</p>
        <div class="space-y-4">
            <input type="email" id="login-email" placeholder="Email" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <button onclick="login()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-xl hover:shadow-xl transition">
                –£–≤—ñ–π—Ç–∏
            </button>
        </div>
        <p class="text-center text-sm text-gray-500 mt-4">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? <span class="text-blue-600 cursor-pointer hover:underline" onclick="showScreen('register')">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</span></p>
        <p class="text-center text-xs text-gray-400 mt-2">–ê–¥–º—ñ–Ω? <span class="text-purple-600 cursor-pointer hover:underline" onclick="showScreen('admin-login')">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</span></p>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <div class="flex flex-col gap-2">
                <button onclick="showLegalDoc('privacy')" class="text-xs text-blue-600 hover:underline">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</button>
                <button onclick="showLegalDoc('disclaimer')" class="text-xs text-blue-600 hover:underline">–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ</button>
                <button onclick="showLegalDoc('terms')" class="text-xs text-blue-600 hover:underline">–î–æ–≥–æ–≤—ñ—Ä –ø—É–±–ª—ñ—á–Ω–æ—ó –æ—Ñ–µ—Ä—Ç–∏</button>
            </div>
        </div>
    </div>
</div>

<div id="screen-admin-login" class="hidden min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-purple-50 via-pink-50 to-red-50">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-10 fade-in">
        <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-32 h-32 mx-auto mb-6 object-contain">
        <h2 class="text-3xl font-black text-center mb-2 text-purple-600">üîê –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <p class="text-gray-600 text-center mb-6">–í–≤–µ–¥—ñ—Ç—å –∞–¥–º—ñ–Ω-–∫–æ–¥ –¥–ª—è –¥–æ—Å—Ç—É–ø—É</p>
        <div class="space-y-4">
            <input type="password" id="admin-code-input" placeholder="–ê–¥–º—ñ–Ω-–∫–æ–¥" class="w-full px-4 py-3 border-2 rounded-xl focus:border-purple-500 outline-none">
            <button onclick="adminLogin()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 rounded-xl hover:shadow-xl transition">
                –£–≤—ñ–π—Ç–∏
            </button>
        </div>
        <p class="text-center text-sm text-gray-500 mt-4"><span class="text-blue-600 cursor-pointer hover:underline" onclick="showScreen('login')">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≤—Ö–æ–¥—É</span></p>
    </div>
</div>

<div id="screen-admin" class="hidden min-h-screen bg-gray-50">
    <nav class="bg-gradient-to-r from-purple-600 to-pink-600 shadow-lg">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-12 h-12 object-contain bg-white rounded-full p-2">
                <h2 class="text-2xl font-black text-white">üîê –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="toggleAdminAI()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-semibold px-4 py-2 rounded-lg transition">ü§ñ –®–Ü –ê–Ω–∞–ª—ñ—Ç–∏–∫</button>
                <button onclick="adminLogout()" class="text-white hover:text-gray-200 font-semibold">–í–∏–π—Ç–∏</button>
            </div>
        </div>
    </nav>
    
    <div class="max-w-7xl mx-auto p-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">–í—Å—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h3>
                    <span class="text-3xl">üë•</span>
                </div>
                <div class="text-4xl font-black text-blue-600" id="admin-total-users">0</div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">–ó–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å</h3>
                    <span class="text-3xl">üéì</span>
                </div>
                <div class="text-4xl font-black text-green-600" id="admin-completed">0</div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">–ê–∫—Ç–∏–≤–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏</h3>
                    <span class="text-3xl">üî•</span>
                </div>
                <div class="text-4xl font-black text-orange-600" id="admin-active">0</div>
            </div>
        </div>
        
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-black text-gray-800">‚ö†Ô∏è –õ–æ–≥–∏ –ø–æ–º–∏–ª–æ–∫ –≤—ñ–¥–µ–æ</h3>
                <div class="flex gap-2">
                    <button onclick="refreshVideoErrorLogs()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700">
                        üîÑ –û–Ω–æ–≤–∏—Ç–∏
                    </button>
                    <button onclick="clearVideoErrorLogs()" class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏
                    </button>
                    <button onclick="exportVideoErrors()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700">
                        üíæ –ï–∫—Å–ø–æ—Ä—Ç
                    </button>
                </div>
            </div>
            <div id="video-error-stats" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"></div>
            <div class="overflow-x-auto max-h-96 overflow-y-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="text-left py-2 px-3 font-bold text-gray-700">–ß–∞—Å</th>
                            <th class="text-left py-2 px-3 font-bold text-gray-700">–£—Ä–æ–∫</th>
                            <th class="text-left py-2 px-3 font-bold text-gray-700">Video ID</th>
                            <th class="text-left py-2 px-3 font-bold text-gray-700">–¢–∏–ø –ø–æ–º–∏–ª–∫–∏</th>
                            <th class="text-left py-2 px-3 font-bold text-gray-700">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
                            <th class="text-left py-2 px-3 font-bold text-gray-700">–û–ø–∏—Å</th>
                        </tr>
                    </thead>
                    <tbody id="video-error-logs-table"></tbody>
                </table>
            </div>
        </div>
        
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-black text-gray-800">üìã –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h3>
                <button onclick="exportUsers()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700">
                    üíæ –ï–∫—Å–ø–æ—Ä—Ç CSV
                </button>
            </div>
            
            <div class="mb-4">
                <input type="text" id="admin-search" placeholder="üîç –ü–æ—à—É–∫ –∑–∞ —ñ–º'—è–º, –ø–æ–∑–∏–≤–Ω–∏–º –∞–±–æ –∫–æ–¥–æ–º..." class="w-full px-4 py-3 border-2 rounded-xl focus:border-purple-500 outline-none" onkeyup="filterUsers()">
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="text-left py-3 px-4 font-bold text-gray-700">–Ü–º'—è</th>
                            <th class="text-left py-3 px-4 font-bold text-gray-700">Email</th>
                            <th class="text-center py-3 px-4 font-bold text-gray-700">–ü—Ä–æ–≥—Ä–µ—Å</th>
                            <th class="text-center py-3 px-4 font-bold text-gray-700">–ë–∞–ª–∏</th>
                            <th class="text-center py-3 px-4 font-bold text-gray-700">–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</th>
                            <th class="text-center py-3 px-4 font-bold text-gray-700">–î—ñ—ó</th>
                        </tr>
                    </thead>
                    <tbody id="admin-users-table">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="admin-ai-assistant" class="hidden fixed bottom-6 right-6 w-[500px] bg-white rounded-2xl shadow-2xl border-2 border-purple-300 overflow-hidden z-50">
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-4 flex items-center justify-between">
            <h3 class="text-white font-bold">ü§ñ –®–Ü –ê–Ω–∞–ª—ñ—Ç–∏–∫ –ê–¥–º—ñ–Ω–∞</h3>
            <button onclick="toggleAdminAI()" class="text-white hover:text-gray-200">‚úï</button>
        </div>
        <div id="admin-ai-chat" class="ai-chat p-4 bg-gray-50" style="min-height: 400px; max-height: 500px;"></div>
        <div class="p-4 border-t bg-white">
            <div class="mb-3 flex gap-2">
                <button onclick="analyzeAllUsers()" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700">üìä –ê–Ω–∞–ª—ñ–∑ —É—Å—ñ—Ö</button>
                <button onclick="analyzeLowPerformers()" class="flex-1 bg-orange-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-orange-700">‚ö†Ô∏è –°–ª–∞–±–∫—ñ</button>
                <button onclick="analyzeTopPerformers()" class="flex-1 bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-green-700">üèÜ –ö—Ä–∞—â—ñ</button>
            </div>
            <div class="flex gap-2">
                <input type="text" id="admin-ai-input" placeholder="–ó–∞–ø–∏—Ç–∞–π—Ç–µ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤..." class="flex-1 px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none" onkeypress="if(event.key==='Enter') sendAdminAIMessage()">
                <button onclick="sendAdminAIMessage()" class="bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-purple-700">‚Üí</button>
            </div>
        </div>
    </div>
    
    <div id="admin-chat-modal" class="hidden fixed bottom-6 right-6 w-[500px] bg-white rounded-2xl shadow-2xl border-2 border-purple-300 overflow-hidden z-50">
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-4 flex items-center justify-between">
            <div>
                <h3 class="text-white font-bold">üí¨ –ß–∞—Ç –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º</h3>
                <p class="text-white text-xs" id="admin-chat-user-name"></p>
            </div>
            <button onclick="closeAdminChat()" class="text-white hover:text-gray-200">‚úï</button>
        </div>
        <div id="admin-chat-messages" class="ai-chat p-4 bg-gray-50" style="min-height: 400px; max-height: 500px;"></div>
        <div class="p-4 border-t bg-white">
            <div class="flex gap-2">
                <input type="text" id="admin-chat-input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." class="flex-1 px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none" onkeypress="if(event.key==='Enter') sendAdminMessage()">
                <button onclick="sendAdminMessage()" class="bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-purple-700">‚Üí</button>
            </div>
        </div>
    </div>
</div>

<div id="screen-welcome" class="hidden min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <div class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full p-12 fade-in text-center">
        <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-40 h-40 mx-auto mb-6 object-contain">
        <h1 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
            –í—ñ—Ç–∞—î–º–æ, <span id="welcome-name"></span>!
        </h1>
        <p class="text-xl text-gray-600 mb-2">–í—ñ–¥–µ–æ-–∫—É—Ä—Å –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó –Ω–µ—Å–≤—ñ–¥–æ–º–∏—Ö –ø—Ä–æ–≥—Ä–∞–º</p>
        <p class="text-sm text-gray-500 mb-8">–í–∞—à email: <strong id="welcome-email"></strong></p>
        <div class="grid grid-cols-4 gap-4 py-6 border-y border-gray-200 mb-8">
            <div><div class="text-3xl font-bold text-blue-600">16</div><div class="text-sm text-gray-500">–£—Ä–æ–∫—ñ–≤</div></div>
            <div><div class="text-3xl font-bold text-purple-600">80</div><div class="text-sm text-gray-500">–ü–∏—Ç–∞–Ω—å</div></div>
            <div><div class="text-3xl font-bold text-indigo-600">~3</div><div class="text-sm text-gray-500">–ì–æ–¥–∏–Ω–∏</div></div>
            <div><div class="text-3xl font-bold text-pink-600">400</div><div class="text-sm text-gray-500">–ë–∞–ª—ñ–≤</div></div>
        </div>
        <button onclick="showScreen('dashboard')" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white text-xl font-bold py-5 px-12 rounded-2xl hover:shadow-xl transition">
            –†–æ–∑–ø–æ—á–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è ‚Üí
        </button>
    </div>
</div>

<div id="screen-dashboard" class="hidden min-h-screen bg-gray-50">
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-12 h-12 object-contain">
                <h2 class="text-2xl font-black text-gray-800">–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏</h2>
            </div>
            <div class="flex items-center gap-6">
                <button onclick="showScreen('workbook')" class="text-gray-600 hover:text-blue-600 font-semibold">üìì –†–æ–±–æ—á–∏–π –∑–æ—à–∏—Ç</button>
                <button onclick="toggleAI()" class="text-gray-600 hover:text-blue-600 font-semibold">ü§ñ –ö—É—Ä–∞–®–Ü</button>
                <button onclick="toggleUserMessages()" class="relative text-gray-600 hover:text-blue-600 font-semibold">
                    üí¨ –ó–≤'—è–∑–æ–∫ –∑ –¢–†–ï–ù–ï–†–û–ú
                    <span id="unread-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                </button>
                <button onclick="toggleEmailSettings()" class="text-gray-600 hover:text-blue-600 font-semibold" title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è email">üîî</button>
                <div class="text-right">
                    <div class="text-xs text-gray-500">–ü—Ä–æ–≥—Ä–µ—Å</div>
                    <div class="text-lg font-bold text-blue-600"><span id="progress">0</span>/17</div>
                </div>
                <button onclick="showProfile()" class="flex items-center gap-2 text-gray-600 hover:text-blue-600">
                    <img id="nav-avatar" src="" alt="Avatar" class="w-8 h-8 rounded-full object-cover border-2 border-blue-500" onerror="this.src='https://ui-avatars.com/api/?name=User&background=3B82F6&color=fff'">
                </button>
                <button onclick="logout()" class="text-red-600 hover:text-red-800 text-sm">–í–∏–π—Ç–∏</button>
            </div>
        </div>
    </nav>
    <div class="max-w-7xl mx-auto p-6">
        <div id="lessons-container" class="space-y-4"></div>
    </div>
    
    <div id="ai-assistant" class="hidden fixed bottom-6 right-6 w-96 bg-white rounded-2xl shadow-2xl border-2 border-blue-200 overflow-hidden z-50">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-4 flex items-center justify-between">
            <h3 class="text-white font-bold">ü§ñ –ö—É—Ä–∞–®–Ü - –ø–æ–º—ñ—á–Ω–∏–∫ –æ–Ω–ª–∞–π–Ω</h3>
            <button onclick="toggleAI()" class="text-white hover:text-gray-200">‚úï</button>
        </div>
        <div id="ai-chat" class="ai-chat p-4 bg-gray-50" style="min-height: 300px; max-height: 400px;"></div>
        <div class="p-4 border-t bg-white">
            <div class="flex gap-2">
                <input type="text" id="ai-input" placeholder="–ó–∞–¥–∞–π—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è..." class="flex-1 px-4 py-2 border-2 rounded-lg focus:border-blue-500 outline-none" onkeypress="if(event.key==='Enter') sendAIMessage()">
                <button onclick="sendAIMessage()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700">‚Üí</button>
            </div>
        </div>
    </div>
    
    <div id="user-messages" class="hidden fixed bottom-6 right-6 w-[450px] bg-white rounded-2xl shadow-2xl border-2 border-blue-300 overflow-hidden z-50">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-4 flex items-center justify-between">
            <h3 class="text-white font-bold">üí¨ –ó–≤'—è–∑–æ–∫ –∑ –¢–†–ï–ù–ï–†–û–ú</h3>
            <button onclick="toggleUserMessages()" class="text-white hover:text-gray-200">‚úï</button>
        </div>
        <div id="user-messages-chat" class="ai-chat p-4 bg-gray-50" style="min-height: 350px; max-height: 450px;"></div>
        <div class="p-4 border-t bg-white">
            <div class="flex gap-2">
                <input type="text" id="user-message-input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." class="flex-1 px-4 py-2 border-2 rounded-lg focus:border-blue-500 outline-none" onkeypress="if(event.key==='Enter') sendUserMessage()">
                <button onclick="sendUserMessage()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700">‚Üí</button>
            </div>
        </div>
    </div>
    
    <div id="email-settings-modal" class="hidden fixed bottom-6 right-6 w-[450px] bg-white rounded-2xl shadow-2xl border-2 border-blue-300 overflow-hidden z-50">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-4 flex items-center justify-between">
            <h3 class="text-white font-bold">üîî Email —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h3>
            <button onclick="toggleEmailSettings()" class="text-white hover:text-gray-200">‚úï</button>
        </div>
        <div class="p-6">
            <div class="mb-6">
                <div class="flex items-center justify-between mb-4 pb-4 border-b">
                    <div>
                        <div class="font-bold text-gray-800">–ù–æ–≤—ñ —É—Ä–æ–∫–∏</div>
                        <div class="text-sm text-gray-500">–û—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤—ñ —É—Ä–æ–∫–∏</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="email-new-lessons" class="sr-only peer" onchange="saveEmailPreferences()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between mb-4 pb-4 border-b">
                    <div>
                        <div class="font-bold text-gray-800">–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—É</div>
                        <div class="text-sm text-gray-500">–í–∞–∂–ª–∏–≤—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–º—ñ–Ω–∏</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="email-updates" class="sr-only peer" onchange="saveEmailPreferences()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between mb-4 pb-4 border-b">
                    <div>
                        <div class="font-bold text-gray-800">–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è</div>
                        <div class="text-sm text-gray-500">–ü—Ä–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ —É—Ä–æ–∫–∏</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="email-reminders" class="sr-only peer" onchange="saveEmailPreferences()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between">
                    <div>
                        <div class="font-bold text-gray-800">–©–æ—Ç–∏–∂–Ω–µ–≤–∏–π –∑–≤—ñ—Ç</div>
                        <div class="text-sm text-gray-500">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—É</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="email-weekly" class="sr-only peer" onchange="saveEmailPreferences()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>
            
            <div id="email-status" class="hidden mb-4 p-3 rounded-lg text-sm"></div>
            
            <button onclick="testEmailNotification()" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition">
                üìß –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π email
            </button>
        </div>
    </div>
</div>

<div id="screen-lesson" class="hidden min-h-screen bg-gray-50 p-6">
    <div class="max-w-4xl mx-auto">
        <button onclick="showScreen('dashboard')" class="mb-6 text-blue-600 hover:text-blue-800 font-semibold">‚Üê –ù–∞–∑–∞–¥ –¥–æ —É—Ä–æ–∫—ñ–≤</button>
        <div id="lesson-content"></div>
    </div>
</div>

<div id="screen-workbook" class="hidden min-h-screen bg-gray-50 p-6">
    <div class="max-w-4xl mx-auto">
        <button onclick="showScreen('dashboard')" class="mb-6 text-blue-600 hover:text-blue-800 font-semibold">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <h2 class="text-3xl font-black mb-6">üìì –ú—ñ–π –†–æ–±–æ—á–∏–π –ó–æ—à–∏—Ç</h2>
            <p class="text-gray-600 mb-4">–ó–∞–ø–∏—Å—É–π—Ç–µ –≤–∞—à—ñ –¥—É–º–∫–∏, —ñ–Ω—Å–∞–π—Ç–∏ —Ç–∞ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—ñ–¥ —á–∞—Å –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∫—É—Ä—Å—É</p>
            
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl mb-6 border-2 border-blue-200">
                <h3 class="text-xl font-bold mb-4 text-gray-800">üìö –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <a href="https://drive.google.com/file/d/1Op0LRh8kPd6jTdXlGBC4GrcgQmNtPja-/view?usp=sharing" target="_blank" class="flex items-center gap-3 bg-white p-4 rounded-lg hover:shadow-lg transition border-2 border-transparent hover:border-blue-400">
                        <span class="text-3xl">üá∫üá¶</span>
                        <div>
                            <div class="font-bold text-gray-800">–ú–µ—Ç–æ–¥–∏—á–∫–∞ (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é)</div>
                            <div class="text-xs text-gray-500">–†–æ–±–æ—á–∞ —Ç–µ—Ç—Ä–∞–¥—å PDF</div>
                        </div>
                    </a>
                    <a href="https://drive.google.com/file/d/1_I7ZTkRIdg2fvbfBP5n5Khb5A8esoJyZ/view?usp=sharing" target="_blank" class="flex items-center gap-3 bg-white p-4 rounded-lg hover:shadow-lg transition border-2 border-transparent hover:border-blue-400">
                        <span class="text-3xl">üá∑üá∫</span>
                        <div>
                            <div class="font-bold text-gray-800">–ú–µ—Ç–æ–¥–∏—á–∫–∞ (—Ä–æ—Å—ñ–π—Å—å–∫–æ—é)</div>
                            <div class="text-xs text-gray-500">–†–æ–±–æ—á–∞—è —Ç–µ—Ç—Ä–∞–¥—å PDF</div>
                        </div>
                    </a>
                    <a href="#" style="display:none;" target="_blank" class="flex items-center gap-3 bg-white p-4 rounded-lg hover:shadow-lg transition border-2 border-transparent hover:border-blue-400">
                        <span class="text-3xl">‚úÖ</span>
                        <div>
                            <div class="font-bold text-gray-800">–¢–µ—Å—Ç–∏ (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é)</div>
                            <div class="text-xs text-gray-500">–Ü—Ç–æ–≥–æ–≤—ñ —Ç–µ—Å—Ç–∏ PDF</div>
                        </div>
                    </a>
                    <a href="#" style="display:none;" target="_blank" class="flex items-center gap-3 bg-white p-4 rounded-lg hover:shadow-lg transition border-2 border-transparent hover:border-blue-400">
                        <span class="text-3xl">‚úÖ</span>
                        <div>
                            <div class="font-bold text-gray-800">–¢–µ—Å—Ç—ã (—Ä—É—Å—Å–∫–∏–π)</div>
                            <div class="text-xs text-gray-500">–ò—Ç–æ–≥–æ–≤—ã–µ —Ç–µ—Å—Ç—ã PDF</div>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl mb-6 border-2 border-green-200">
                <h3 class="text-xl font-bold mb-4 text-gray-800">üì± –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º</h3>
                <p class="text-gray-600 mb-4">–ó–±–µ—Ä–µ–∂—ñ—Ç—å –∫—É—Ä—Å –Ω–∞ –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –±–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-bold text-gray-800">–°—Ç–æ—Ä—ñ–Ω–∫–∏ –∫—É—Ä—Å—É</span>
                            <span id="cache-pages-status" class="text-sm text-green-600">‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ</span>
                        </div>
                        <div class="text-sm text-gray-500">–î–æ—Å—Ç—É–ø–Ω—ñ –æ—Ñ–ª–∞–π–Ω</div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-bold text-gray-800">–†–æ–∑–º—ñ—Ä –∫–µ—à—É</span>
                            <span id="cache-size" class="text-sm text-blue-600">~ 2 MB</span>
                        </div>
                        <div class="text-sm text-gray-500">–ó–∞–π–Ω—è—Ç–æ –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó</div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-4">
                    <div class="flex items-start gap-2">
                        <span class="text-xl">‚ö†Ô∏è</span>
                        <div class="text-sm text-yellow-800">
                            <strong>–í–∞–∂–ª–∏–≤–æ:</strong> –í—ñ–¥–µ–æ YouTube –Ω–µ –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –æ—Ñ–ª–∞–π–Ω —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è YouTube. –í –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç–µ–∫—Å—Ç–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏, —Ç–µ—Å—Ç–∏ —Ç–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-2">
                    <button onclick="clearOfflineCache()" class="flex-1 bg-red-600 text-white font-semibold py-3 rounded-lg hover:bg-red-700 transition">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
                    </button>
                    <button onclick="checkCacheStatus()" class="flex-1 bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition">
                        üîÑ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
                    </button>
                </div>
            </div>
            
            <textarea id="workbook-text" class="w-full h-96 p-4 border-2 rounded-xl focus:border-blue-500 outline-none font-mono" placeholder="–ü–æ—á–Ω—ñ—Ç—å –ø–∏—Å–∞—Ç–∏...\n\n–ù–∞–ø—Ä–∏–∫–ª–∞–¥:\n- –Ø–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ —è –ø–æ–º—ñ—Ç–∏–≤(–ª–∞) —É —Å–≤–æ—î–º—É –∂–∏—Ç—Ç—ñ?\n- –Ø–∫—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –≤—ñ–¥–≥—É–∫?\n- –©–æ —Ö–æ—á—É –∑–º—ñ–Ω–∏—Ç–∏?\n- –ú–æ—ó —Ü—ñ–ª—ñ –ø—ñ—Å–ª—è –∫—É—Ä—Å—É..."></textarea>
            <button onclick="saveWorkbook()" class="mt-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-8 rounded-xl hover:shadow-xl transition">
                üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–æ—Ç–∞—Ç–∫–∏
            </button>
        </div>
    </div>
</div>

<div id="modal-certificate-name" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-6 z-50">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 fade-in">
        <h2 class="text-2xl font-black text-center mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">üéâ –í—ñ—Ç–∞—î–º–æ!</h2>
        <p class="text-gray-600 text-center mb-6">–í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å! –í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤–Ω–µ —ñ–º'—è –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É:</p>
        <div class="space-y-4">
            <input type="text" id="cert-full-name" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è" class="w-full px-4 py-3 border-2 rounded-xl focus:border-blue-500 outline-none">
            <button onclick="generateCertificate()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-xl hover:shadow-xl transition">
                –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
            </button>
        </div>
    </div>
</div>

<div id="screen-certificate" class="hidden min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6">
    <div class="max-w-5xl mx-auto">
        <div id="certificate" class="certificate-frame bg-white rounded-2xl shadow-2xl p-16 text-center relative" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);">
            <div class="watermark">VERIFIED</div>
            <img src="https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp" alt="–õ–æ–≥–æ—Ç–∏–ø" class="w-40 h-40 mx-auto mb-8 object-contain bg-white rounded-full p-4 shadow-xl relative z-10">
            <h1 class="text-6xl font-black text-white mb-4 tracking-wide relative z-10">–°–ï–†–¢–ò–§–Ü–ö–ê–¢</h1>
            <p class="text-2xl text-white mb-10 font-light relative z-10">–ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫—É—Ä—Å—É</p>
            <div class="bg-white rounded-2xl p-10 mb-10 shadow-2xl relative z-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-6" id="cert-name"></h2>
                <div class="grid grid-cols-4 gap-6 py-8 border-y-2 border-gray-200 my-6">
                    <div>
                        <div class="text-4xl font-black text-blue-600" id="cert-lessons">17</div>
                        <div class="text-sm text-gray-500 font-semibold mt-2">–£—Ä–æ–∫—ñ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</div>
                    </div>
                    <div>
                        <div class="text-4xl font-black text-purple-600" id="cert-score">0</div>
                        <div class="text-sm text-gray-500 font-semibold mt-2">–ë–∞–ª—ñ–≤ –Ω–∞–±—Ä–∞–Ω–æ</div>
                    </div>
                    <div>
                        <div class="text-4xl font-black text-indigo-600" id="cert-hours">0</div>
                        <div class="text-sm text-gray-500 font-semibold mt-2">–ì–æ–¥–∏–Ω –Ω–∞–≤—á–∞–Ω–Ω—è</div>
                    </div>
                    <div>
                        <div class="text-4xl font-black text-green-600">100%</div>
                        <div class="text-sm text-gray-500 font-semibold mt-2">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è</div>
                    </div>
                </div>
                <p class="text-gray-600 mt-6 text-base font-semibold">–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è: <span class="text-gray-800" id="cert-date"></span></p>
            </div>
            <div class="grid grid-cols-2 gap-4 relative z-10">
                <div class="bg-white bg-opacity-20 rounded-xl p-6 backdrop-blur-sm">
                    <p class="text-white text-xl font-semibold">üéâ –í—ñ—Ç–∞—î–º–æ –∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—î—é!</p>
                    <p class="text-white text-sm mt-2 font-light">–ö—É—Ä—Å "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏: –Ω–µ–≤–∏–¥–∏–º—ñ –Ω–∏—Ç–∫–∏"</p>
                </div>
                <div class="bg-white rounded-xl p-4 flex flex-col items-center justify-center">
                    <canvas id="cert-qrcode" class="w-24 h-24 mb-2"></canvas>
                    <p class="text-xs text-gray-600 font-semibold">–í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è</p>
                    <p class="text-xs text-gray-500 mt-1">ID: <span id="cert-id"></span></p>
                </div>
            </div>
        </div>
        <div class="flex gap-4 mt-8 justify-center flex-wrap">
            <button onclick="downloadCertificatePNG()" class="bg-white text-blue-600 font-bold py-3 px-8 rounded-xl hover:shadow-xl transition">
                üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PNG
            </button>
            <button onclick="downloadCertificatePDF()" class="bg-white text-red-600 font-bold py-3 px-8 rounded-xl hover:shadow-xl transition">
                üìÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF
            </button>
            <button onclick="window.print()" class="bg-white text-purple-600 font-bold py-3 px-8 rounded-xl hover:shadow-xl transition">
                üñ®Ô∏è –†–æ–∑–¥—Ä—É–∫—É–≤–∞—Ç–∏
            </button>
            <button onclick="showScreen('dashboard')" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-8 rounded-xl hover:shadow-xl transition">
                –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —É—Ä–æ–∫—ñ–≤
            </button>
        </div>
    </div>
</div>

<script>
const lessons = [
    { id: 0, title: '–í–≤—ñ–¥–Ω–∏–π —É—Ä–æ–∫: –ó–Ω–∞–π–æ–º—Å—Ç–≤–æ –∑ –∫—É—Ä—Å–æ–º', description: '–í—ñ—Ç–∞–Ω–Ω—è —Ç–∞ –æ–≥–ª—è–¥ –∫—É—Ä—Å—É –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –î–∏—Ä–µ–∫—Ç–∏–≤–∏', videoUrl: 'https://www.youtube.com/embed/wmaRjk2aK3E', duration: '05:00', points: 5, quiz: [
        { q: '–©–æ —Ç–∞–∫–µ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞?', opts: ['–ù–µ—Å–≤—ñ–¥–æ–º–µ –ø–æ—Å–ª–∞–Ω–Ω—è', '–ü—Ä—è–º–∞ –≤–∫–∞–∑—ñ–≤–∫–∞', '–ü—Ä–∞–≤–∏–ª–æ'], c: 0 },
        { q: '–°–∫—ñ–ª—å–∫–∏ —É—Ä–æ–∫—ñ–≤ —É –∫—É—Ä—Å—ñ?', opts: ['10', '16', '12'], c: 1 },
        { q: '–Ø–∫–∞ –º–µ—Ç–∞ –∫—É—Ä—Å—É?', opts: ['–†–æ–∑–≤–∞–≥–∞', '–£—Å–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è', '–ó–Ω–∞–Ω–Ω—è'], c: 1 },
        { q: '–ß–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–æ–±–æ—á–∞ —Ç–µ—Ç—Ä–∞–¥—å?', opts: ['–ù—ñ', '–ù–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ', '–¢–∞–∫'], c: 2 },
        { q: '–©–æ –≤–∞–∂–ª–∏–≤–æ –≤ –∫—É—Ä—Å—ñ?', opts: ['–ß–µ—Å–Ω—ñ—Å—Ç—å –∑ —Å–æ–±–æ—é', '–®–≤–∏–¥–∫—ñ—Å—Ç—å', '–ü–µ—Ä—Ñ–µ–∫—Ü—ñ–æ–Ω—ñ–∑–º'], c: 0 }
    ]},
    { id: 1, title: '–£—Ä–æ–∫ 0: –©–æ —Ç–∞–∫–µ –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ –î–∏—Ä–µ–∫—Ç–∏–≤–∞?', description: '–û–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è –∑ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—î—é, —ñ—Å—Ç–æ—Ä—ñ—î—é —Ç–∞ –≤–ø–ª–∏–≤–æ–º –Ω–µ—Å–≤—ñ–¥–æ–º–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –Ω–∞ –∂–∏—Ç—Ç—è', videoUrl: 'https://www.youtube.com/embed/z-ivL3YtFoo', duration: '08:15', points: 10, quiz: [
        { q: '–•—Ç–æ –≤–ø–µ—Ä—à–µ –æ–ø–∏—Å–∞–≤ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤?', opts: ['–ï—Ä—ñ–∫ –ë–µ—Ä–Ω', '–ó–∏“ë–º—É–Ω–¥ –§—Ä–æ–π–¥', '–ö–∞—Ä–ª –Æ–Ω–≥'], c: 0 },
        { q: '–ù–∞ —è–∫–æ–º—É –≤—ñ—Ü—ñ –¥–∏—Ç–∏–Ω–∞ –∑–∞–∑–≤–∏—á–∞–π —Ñ–æ—Ä–º—É—î –±—ñ–ª—å—à—ñ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤?', opts: ['4-7 —Ä–æ–∫—ñ–≤', '0-3 —Ä–æ–∫–∏', '8-12 —Ä–æ–∫—ñ–≤'], c: 1 },
        { q: '–©–æ —Ç–∞–∫–µ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞?', opts: ['–ù–µ—Å–≤—ñ–¥–æ–º–µ –ø–æ—Å–ª–∞–Ω–Ω—è –≤—ñ–¥ –±–∞—Ç—å–∫—ñ–≤', '–ü—Ä—è–º–∞ –≤–∫–∞–∑—ñ–≤–∫–∞ –±–∞—Ç—å–∫—ñ–≤', '–ü—Ä–∞–≤–∏–ª–æ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏'], c: 0 },
        { q: '–°–∫—ñ–ª—å–∫–∏ –æ—Å–Ω–æ–≤–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ –≤–∏–¥—ñ–ª—è—é—Ç—å?', opts: ['5', '20', '12'], c: 2 },
        { q: '–Ø–∫ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –¥–æ—Ä–æ—Å–ª–µ –∂–∏—Ç—Ç—è?', opts: ['–§–æ—Ä–º—É—é—Ç—å —Å—Ü–µ–Ω–∞—Ä—ñ–π –∂–∏—Ç—Ç—è', '–ù–µ –≤–ø–ª–∏–≤–∞—é—Ç—å', '–¢—ñ–ª—å–∫–∏ –≤ –¥–∏—Ç–∏–Ω—Å—Ç–≤—ñ'], c: 0 }
    ]},
    { id: 2, title: '–£—Ä–æ–∫ 1: –ù–µ –∂–∏–≤–∏ + –û–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è', description: '–ù–∞–π–ø–æ—Ç—É–∂–Ω—ñ—à–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞. –¢–µ–æ—Ä—ñ—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è', videoUrl: 'https://www.youtube.com/embed/c9Fjiv4JfAY', videoUrl2: 'https://www.youtube.com/embed/D9lZVUElleY', duration: '25:00', points: 25, quiz: [
        { q: '–Ø–∫–∏–π –ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤–∏–π –ø—Ä–æ—è–≤ –Ω–∞–π–±—ñ–ª—å—à –ø–æ–≤\'—è–∑–∞–Ω–∏–π –∑ –¥–∏—Ä–µ–∫—Ç–∏–≤–æ—é ¬´–ù–µ –∂–∏–≤–∏¬ª?', opts: ['–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü—ñ—è', '–•—Ä–æ–Ω—ñ—á–Ω—ñ —Ö–≤–æ—Ä–æ–±–∏', '–ù–∞–¥–º—ñ—Ä–Ω–∏–π –ø–µ—Ä—Ñ–µ–∫—Ü—ñ–æ–Ω—ñ–∑–º'], c: 1 },
        { q: '–Ø–∫–∞ —Ñ—Ä–∞–∑–∞ –º–æ–∂–µ —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤—É ¬´–ù–µ –∂–∏–≤–∏¬ª?', opts: ['–Ø —Ç–µ–±–µ –ª—é–±–ª—é', '–ö—Ä–∞—â–µ –± —Ç–∏ –Ω–µ –Ω–∞—Ä–æ–¥–∏–≤—Å—è', '–¢–∏ –º–æ—è —Ä–∞–¥—ñ—Å—Ç—å'], c: 1 },
        { q: '–Ø–∫ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑–¥–æ—Ä–æ–≤\'—è?', opts: ['–°–ø–æ—Ä—Ç–∏–≤–Ω—ñ—Å—Ç—å', '–°–∞–º–æ—Ä—É–π–Ω—ñ–≤–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞', '–ú—ñ—Ü–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è'], c: 1 },
        { q: '–©–æ –≤—ñ–¥—á—É–≤–∞—î –ª—é–¥–∏–Ω–∞ –∑ —Ü—ñ—î—é –¥–∏—Ä–µ–∫—Ç–∏–≤–æ—é?', opts: ['–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å', '–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø—Ä–∞–≤–∞ –∂–∏—Ç–∏', '–ü–æ–≤–Ω–æ—Ç—É –∂–∏—Ç—Ç—è'], c: 1 },
        { q: '–Ø–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –¥–∏—Ä–µ–∫—Ç–∏–≤–æ—é ¬´–ù–µ –∂–∏–≤–∏¬ª?', opts: ['–ë–æ—Ä–æ—Ç–∏—Å—è –∑ –Ω–µ—é', '–î–æ–∑–≤–æ–ª–∏—Ç–∏ —Å–æ–±—ñ –∂–∏—Ç–∏', '–Ü–≥–Ω–æ—Ä—É–≤–∞—Ç–∏'], c: 1 }
    ]},
    { id: 3, title: '–£—Ä–æ–∫ 2: –ù–µ –±—É–¥—å —Å–æ–±–æ—é', description: '–ó–∞–±–æ—Ä–æ–Ω–∞ –Ω–∞ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –ø—Ä–æ—è–≤ —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö –µ–º–æ—Ü—ñ–π. –°—Ü–µ–Ω–∞—Ä—ñ–π –•–∞–º–µ–ª–µ–æ–Ω', videoUrl: 'https://www.youtube.com/embed/CYchGoaws5s', duration: '11:00', points: 25, quiz: [
        { q: '–©–æ —Ç–∞–∫–µ —Å—Ü–µ–Ω–∞—Ä—ñ–π –•–∞–º–µ–ª–µ–æ–Ω?', opts: ['–ü–æ—Å—Ç—ñ–π–Ω–∞ –∑–º—ñ–Ω–∞ –º–∞—Å–æ–∫ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –æ—Ç–æ—á–µ–Ω–Ω—é', '–°—Ö–∏–ª—å–Ω—ñ—Å—Ç—å –¥–æ —Ä–∏–∑–∏–∫—É', '–ù–µ–∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –ø—Ä–∏–π–º–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è'], c: 0 },
        { q: '–Ø–∫–∞ —Ñ—Ä–∞–∑–∞ —Ñ–æ—Ä–º—É—î ¬´–ù–µ –±—É–¥—å —Å–æ–±–æ—é¬ª?', opts: ['–¢–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π', '–ë—É–¥—å —è–∫ –≤—Å—ñ', '–ë—É–¥—å —Å–∞–º–∏–º —Å–æ–±–æ—é'], c: 1 },
        { q: '–ì–æ–ª–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ü—ñ—î—ó –¥–∏—Ä–µ–∫—Ç–∏–≤–∏?', opts: ['–ë–∞–≥–∞—Ç–æ –¥—Ä—É–∑—ñ–≤', '–°–∞–º–æ—Ç–Ω—ñ—Å—Ç—å', '–í—Ç—Ä–∞—Ç–∞ —Å–µ–±–µ —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ'], c: 2 },
        { q: '–Ø–∫ –ª—é–¥–∏–Ω–∞ –æ–±–∏—Ä–∞—î –ø—Ä–æ—Ñ–µ—Å—ñ—é –∑ —Ü—ñ—î—é –¥–∏—Ä–µ–∫—Ç–∏–≤–æ—é?', opts: ['–ó–∞ –±–∞–∂–∞–Ω–Ω—è–º –±–∞—Ç—å–∫—ñ–≤', '–ó–∞ –ø–æ–∫–ª–∏–∫–∞–Ω–Ω—è–º', '–õ–µ–≥–∫–æ'], c: 0 },
        { q: '–®–ª—è—Ö –¥–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è?', opts: ['–°–ª—É—Ö–∞—Ç–∏ —ñ–Ω—à–∏—Ö', '–ü—ñ–∑–Ω–∞—Ç–∏ —Å–µ–±–µ —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ', '–ó–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –ø–æ—Å—Ç—ñ–π–Ω–æ'], c: 1 }
    ]},
    { id: 4, title: '–£—Ä–æ–∫ 3: –ù–µ —Ä–æ–±–∏', description: '–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥—ñ–π, —Å—Ö–∏–ª—å–Ω—ñ—Å—Ç—å –¥–æ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü—ñ—ó, —Å–∞–±–æ—Ç–∞–∂ —Å–≤–æ—ó—Ö –ø–æ—á–∏–Ω–∞–Ω—å', videoUrl: 'https://www.youtube.com/embed/OsIf05UYbGE', duration: '12:15', points: 25, quiz: [
        { q: '–Ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞—Ç—å–∫—ñ–≤ –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ –ù–µ —Ä–æ–±–∏?', opts: ['–ó–∞–ª–∏—à, —è —Å–∞–º(–∞) –∑—Ä–æ–±–ª—é', '–†–æ–±–∏ –≤—Å–µ —ñ–¥–µ–∞–ª—å–Ω–æ', '–¢–∏ –º–∞—î—à –±—É—Ç–∏ –ª—ñ–¥–µ—Ä–æ–º'], c: 0 },
        { q: '–ì–æ–ª–æ–≤–Ω–∏–π —Å–∏–º–ø—Ç–æ–º –¥–∏—Ä–µ–∫—Ç–∏–≤–∏ ¬´–ù–µ —Ä–æ–±–∏¬ª?', opts: ['–Ü–º–ø—É–ª—å—Å–∏–≤–Ω—ñ—Å—Ç—å', '–ì—ñ–ø–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å', '–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü—ñ—è'], c: 2 },
        { q: '–©–æ –≤—ñ–¥—á—É–≤–∞—î –ª—é–¥–∏–Ω–∞ –ø–µ—Ä–µ–¥ –¥—ñ—î—é?', opts: ['–ü–∞—Ä–∞–ª—ñ–∑—É—é—á–∏–π —Å—Ç—Ä–∞—Ö', '–ï–Ω—Ç—É–∑—ñ–∞–∑–º', '–†–∞–¥—ñ—Å—Ç—å'], c: 0 },
        { q: '–ß–æ–º—É –±–∞—Ç—å–∫–∏ –±–ª–æ–∫—É–≤–∞–ª–∏ –¥—ñ—ó –¥–∏—Ç–∏–Ω–∏?', opts: ['–ó—ñ –∑–ª–æ—Å—Ç—ñ', '–Ü–∑ –ª—é–±–æ–≤—ñ', '–ó —Ç—É—Ä–±–æ—Ç–∏, —â–æ–± –Ω–µ –ø–æ–º–∏–ª–∏–ª–∞—Å—å'], c: 2 },
        { q: '–Ø–∫ –ø–æ–¥–æ–ª–∞—Ç–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤—É?', opts: ['–î—ñ—è—Ç–∏ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏', '–ù—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç–∏', '–ß–µ–∫–∞—Ç–∏ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è'], c: 0 }
    ]},
    { id: 5, title: '–£—Ä–æ–∫ 4: –ù–µ –¥–æ—Å—è–≥–∞–π —É—Å–ø—ñ—Ö—É', description: '–°–∞–º–æ—Å–∞–±–æ—Ç–∞–∂, —Å—Ç—Ä–∞—Ö —É—Å–ø—ñ—Ö—É, –∫–æ–º–ø–ª–µ–∫—Å –ô–æ–Ω–∏', videoUrl: 'https://www.youtube.com/embed/PF6W1UBKNGU', duration: '15:00', points: 25, quiz: [
        { q: '–Ø–∫–∏–π —Ç–µ—Ä–º—ñ–Ω –æ–ø–∏—Å—É—î —Å—Ç–∞–Ω –ª—é–¥–∏–Ω–∏ –∑ –¥–∏—Ä–µ–∫—Ç–∏–≤–æ—é –ù–µ –¥–æ—Ä–æ—Å–ª—ñ—à–∞–π?', opts: ['–°–∏–Ω–¥—Ä–æ–º –≤—ñ–¥–º—ñ–Ω–Ω–∏–∫–∞', '–°–∏–Ω–¥—Ä–æ–º –ü—ñ—Ç–µ—Ä–∞ –ü–µ–Ω–∞', '–°–∏–Ω–¥—Ä–æ–º —Å–∞–º–æ–∑–≤–∞–Ω—Ü—è'], c: 1 },
        { q: '–¢–∏–ø–æ–≤–∞ —Ñ—Ä–∞–∑–∞ –±–∞—Ç—å–∫—ñ–≤?', opts: ['–¢–∏ —â–µ –º–∞–ª–µ–Ω—å–∫–∏–π', '–î–æ—Ä–æ—Å–ª—ñ—à–∞–π —à–≤–∏–¥—à–µ', '–ë—É–¥—å —Å–∞–º–æ—Å—Ç—ñ–π–Ω–∏–º'], c: 0 },
        { q: '–ì–æ–ª–æ–≤–Ω–∏–π —Å—Ç—Ä–∞—Ö?', opts: ['–°–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ', '–£—Å–ø—ñ—Ö—É', '–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ'], c: 1 },
        { q: '–Ø–∫ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö?', opts: ['–†—ñ–≤–Ω–æ–ø—Ä–∞–≤–Ω—ñ—Å—Ç—å', '–õ—ñ–¥–µ—Ä—Å—Ç–≤–æ', '–ü–æ—à—É–∫ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ—ó —Ñ—ñ–≥—É—Ä–∏'], c: 2 },
        { q: '–®–ª—è—Ö –¥–æ –∑—Ä—ñ–ª–æ—Å—Ç—ñ?', opts: ['–£–Ω–∏–∫–∞—Ç–∏ —Ä—ñ—à–µ–Ω—å', '–ü—Ä–∏–π–Ω—è—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ –∂–∏—Ç—Ç—è', '–ó–∞–ª–∏—à–∞—Ç–∏—Å—è –¥–∏—Ç–∏–Ω–æ—é'], c: 1 }
    ]},
    { id: 6, title: '–£—Ä–æ–∫ 5: –ù–µ –±—É–¥—å –≤–∞–∂–ª–∏–≤–∏–º', description: '–°—Ç—Ä–∞—Ö –ø—Ä–∏–≤–µ—Ä—Ç–∞—Ç–∏ —É–≤–∞–≥—É, –≤—ñ–¥—á—É—Ç—Ç—è –Ω–µ–∑–Ω–∞—á—É—â–æ—Å—Ç—ñ', videoUrl: 'https://www.youtube.com/embed/10oQBICrIjc', duration: '13:00', points: 25, quiz: [
        { q: '–©–æ —Ç–∞–∫–µ –∫–æ–º–ø–ª–µ–∫—Å –ô–æ–Ω–∏?', opts: ['–°—Ç—Ä–∞—Ö –ø—É–±–ª—ñ—á–Ω–∏—Ö –≤–∏—Å—Ç—É–ø—ñ–≤', '–°—Ç—Ä–∞—Ö –≤–ª–∞—Å–Ω–æ–≥–æ —É—Å–ø—ñ—Ö—É —Ç–∞ –≤–µ–ª–∏—á—ñ', '–°—Ç—Ä–∞—Ö —Ç–µ–º—Ä—è–≤–∏'], c: 1 },
        { q: '–ö–æ–ª–∏ –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è —Å–∞–±–æ—Ç–∞–∂?', opts: ['–ù–∞ —Ñ—ñ–Ω—ñ—à–Ω—ñ–π –ø—Ä—è–º—ñ–π', '–ù–∞ –ø–æ—á–∞—Ç–∫—É', '–í —Å–µ—Ä–µ–¥–∏–Ω—ñ'], c: 0 },
        { q: '–ß–æ–º—É –±–∞—Ç—å–∫–∏ –±–ª–æ–∫—É–≤–∞–ª–∏ —É—Å–ø—ñ—Ö?', opts: ['–ó —Ä–∞–¥–æ—Å—Ç—ñ', '–Ü–∑ –∑–∞–∑–¥—Ä–æ—Å—Ç—ñ', '–Ü–∑ —Å—Ç—Ä–∞—Ö—É –∑–∞ –¥–∏—Ç–∏–Ω—É'], c: 2 },
        { q: '–¢–∏–ø–æ–≤–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞?', opts: ['–°–≤—è—Ç–∫—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–º–æ–≥–∏', '–ó—É–ø–∏–Ω—è—Ç–∏—Å—è –ø–µ—Ä–µ–¥ —É—Å–ø—ñ—Ö–æ–º', '–î–æ—Å—è–≥–∞—Ç–∏ —Ü—ñ–ª–µ–π'], c: 1 },
        { q: '–ù–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞?', opts: ['–Ø –º–∞—é –ø—Ä–∞–≤–æ –Ω–∞ —É—Å–ø—ñ—Ö', '–£—Å–ø—ñ—Ö –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π', '–¢—Ä–µ–±–∞ –±—É—Ç–∏ —Å–∫—Ä–æ–º–Ω–∏–º'], c: 0 }
    ]},
    { id: 7, title: '–£—Ä–æ–∫ 6: –ù–µ –¥—É–º–∞–π + –†–µ—Ñ—Ä–µ–π–º—ñ–Ω–≥', description: '–ó–∞–±–æ—Ä–æ–Ω–∞ –Ω–∞ –º–∏—Å–ª–µ–Ω–Ω—è. –¢–µ–æ—Ä—ñ—è —Ç–∞ —à–µ—Å—Ç–∏—à–∞–≥–æ–≤–∏–π —Ä–µ—Ñ—Ä–µ–π–º—ñ–Ω–≥', videoUrl: 'https://www.youtube.com/embed/Prbt3xNKH-k', videoUrl2: 'https://www.youtube.com/embed/wbKKNIIvTKk', duration: '25:00', points: 25, quiz: [
        { q: '–Ø–∫ –ª—é–¥–∏–Ω–∞ –∑ –¥–∏—Ä–µ–∫—Ç–∏–≤–æ—é –ù–µ –±—É–¥—å –≤–∞–∂–ª–∏–≤–∏–º –ø–æ–≤–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ–ª–µ–∫—Ç–∏–≤—ñ?', opts: ['–ó–∞–≤–∂–¥–∏ –ø—Ä–∞–≥–Ω–µ –±—É—Ç–∏ –ª—ñ–¥–µ—Ä–æ–º', '–£–Ω–∏–∫–∞—î —É–≤–∞–≥–∏ —Ç–∞ –ø—É–±–ª—ñ—á–Ω–∏—Ö –≤–∏—Å—Ç—É–ø—ñ–≤', '–ü–æ—Å—Ç—ñ–π–Ω–æ —Å–ø–µ—Ä–µ—á–∞—î—Ç—å—Å—è'], c: 1 },
        { q: '–¢–∏–ø–æ–≤–∞ —Ñ—Ä–∞–∑–∞ –¥–∏—Ç–∏–Ω—Å—Ç–≤–∞?', opts: ['–¢–∏ –∑—ñ—Ä–∫–∞', '–ù–µ –≤–∏—Å–æ–≤—É–π—Å—è', '–ë—É–¥—å –ª—ñ–¥–µ—Ä–æ–º'], c: 1 },
        { q: '–û—Å–Ω–æ–≤–Ω–µ –≤—ñ–¥—á—É—Ç—Ç—è?', opts: ['–ó–Ω–∞—á—É—â—ñ—Å—Ç—å', '–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å', '–ù–µ–∑–Ω–∞—á—É—â—ñ—Å—Ç—å'], c: 2 },
        { q: '–Ø–∫ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è –≤ –∫–∞—Ä\'—î—Ä—ñ?', opts: ['–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å', '–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –ø—Ä–æ—Å—É–≤–∞–Ω–Ω—è', '–®–≤–∏–¥–∫–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è'], c: 1 },
        { q: '–©–æ –¥–æ–ø–æ–º–∞–≥–∞—î?', opts: ['–î–æ–∑–≤–æ–ª–∏—Ç–∏ —Å–æ–±—ñ –±—É—Ç–∏ –≤–∏–¥–∏–º–∏–º', '–•–æ–≤–∞—Ç–∏—Å—è –¥–∞–ª—ñ', '–ú–æ–≤—á–∞—Ç–∏ –∑–∞–≤–∂–¥–∏'], c: 0 }
    ]},
    { id: 8, title: '–£—Ä–æ–∫ 7: –ù–µ –±—É–¥—å –±–ª–∏–∑—å–∫–æ', description: '–ü—Ä–æ–±–ª–µ–º–∏ —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö, –≤—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞, —Å—Ç—Ä–∞—Ö –µ–º–æ—Ü—ñ–π–Ω–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ', videoUrl: 'https://www.youtube.com/embed/nxn-1FvVbkc', duration: '11:45', points: 25, quiz: [
        { q: '–Ø–∫–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –∑–∞—Ö–∏—Å—Ç—É –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤—ñ –ù–µ –±—É–¥—å –±–ª–∏–∑—å–∫–æ?', opts: ['–Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—ñ–∑–∞—Ü—ñ—è', '–í—ñ–¥—Å—Ç–æ—Ä–æ–Ω–µ–Ω–Ω—è/–í—ñ–¥—á—É–∂–µ–Ω–Ω—è', '–†–∞—Ü—ñ–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è'], c: 1 },
        { q: '–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—ñ –ø–∞—Ä—Ç–Ω–µ—Ä–∞?', opts: ['–°–ø–æ–∫—ñ–π', '–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è', '–†–∞–¥—ñ—Å—Ç—å'], c: 1 },
        { q: '–¢–∏–ø–æ–≤–∞ —Ñ—Ä–∞–∑–∞ –∑ –¥–∏—Ç–∏–Ω—Å—Ç–≤–∞?', opts: ['–Ø —Ç–µ–±–µ –ª—é–±–ª—é', '–ù–µ –ø—ñ–¥—Ö–æ–¥—å –¥–æ –º–µ–Ω–µ', '–û–±—ñ–π–º–∏ –º–µ–Ω–µ'], c: 1 },
        { q: '–ü–∞—Ç—Ç–µ—Ä–Ω —Å—Ç–æ—Å—É–Ω–∫—ñ–≤?', opts: ['–ë–ª–∏–∑—å–∫—ñ—Å—Ç—å-–≤—ñ–¥—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è', '–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å', '–ì–∞—Ä–º–æ–Ω—ñ—è'], c: 0 },
        { q: '–®–ª—è—Ö –¥–æ –±–ª–∏–∑—å–∫–æ—Å—Ç—ñ?', opts: ['–ë—É—Ç–∏ —Ö–æ–ª–æ–¥–Ω–∏–º', '–£—Å–≤—ñ–¥–æ–º–∏—Ç–∏ —Å—Ç—Ä–∞—Ö —ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –Ω–∏–º', '–£–Ω–∏–∫–∞—Ç–∏ —Å—Ç–æ—Å—É–Ω–∫—ñ–≤'], c: 1 }
    ]},
    { id: 9, title: '–£—Ä–æ–∫ 8: –ù–µ –≤–∑—Ä–æ—Å–ª—ñ–π + –û–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è', description: '–Ü–Ω—Ñ–∞–Ω—Ç–∏–ª—ñ–∑–º, —Å—Ç—Ä–∞—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ. –¢–µ–æ—Ä—ñ—è —Ç–∞ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è', videoUrl: 'https://www.youtube.com/embed/bAH42svX7nQ', videoUrl2: 'https://www.youtube.com/embed/bAH42svX7nQ', duration: '30:00', points: 25, quiz: [
        { q: '–§—Ä–∞–∑–∏ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è?', opts: ['–¢–∏ –≤–∂–µ –Ω–µ –¥–∏—Ç–∏–Ω–∞, —Ö–≤–∞—Ç–∏—Ç –Ω—ã—Ç—å!', '–ì—Ä–∞–π —Å–∫—ñ–ª—å–∫–∏ —Ö–æ—á–µ—à', '–ë—É–¥—å —Å–æ–±–æ—é'], c: 0 },
        { q: '–ß–æ–º—É –≤—Ç–æ–º–∞?', opts: ['–ë–∞–≥–∞—Ç–æ —Ä–æ–±–æ—Ç–∏', '–ë–ª–æ–∫—É—î—Ç—å—Å—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ñ—Å—Ç—å —Ç–∞ –µ–Ω–µ—Ä–≥—ñ—è', '–ù–µ–º–∞—î –≤—ñ–¥–ø–æ—á–∏–Ω–∫—É'], c: 1 },
        { q: '–Ø–∫ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è?', opts: ['–†–∞–¥—ñ—Å—Ç—å', '–í–∏–Ω–∞ –∑–∞ –≤—ñ–¥–ø–æ—á–∏–Ω–æ–∫, –≥—ñ–ø–µ—Ä–∫–æ–Ω—Ç—Ä–æ–ª—å', '–õ–µ–≥–∫—ñ—Å—Ç—å'], c: 1 },
        { q: '–ú–µ—Ç–∞ –≤–ø—Ä–∞–≤–∏?', opts: ['–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É –∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—é –¥–∏—Ç–∏–Ω–æ—é', '–ê–Ω–∞–ª—ñ–∑', '–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è'], c: 0 },
        { q: '–ù–æ–≤–∏–π –≤–∏–±—ñ—Ä?', opts: ['–¢–∏ –º–∞—î—à –ø—Ä–∞–≤–æ –±—É—Ç–∏ —Ä–µ–±—ë–Ω–∫–æ–º', '–ë—É–¥—å —Å–µ—Ä–π–æ–∑–Ω—ñ—à–∏–º', '–ö–æ–Ω—Ç—Ä–æ–ª—é–π —Å–µ–±–µ'], c: 0 }
    ]},
    { id: 10, title: '–£—Ä–æ–∫ 9: –ù–µ –Ω–∞–ª–µ–∂', description: '–í—ñ–¥—á—É—Ç—Ç—è —á—É–∂–∏–Ω—Ü—è, —ñ–∑–æ–ª—è—Ü—ñ—è, –ø—Ä–æ–±–ª–µ–º–∏ –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é', videoUrl: 'https://www.youtube.com/embed/lFamCfeEK4M', duration: '20:00', points: 25, quiz: [
        { q: '–û—Å–Ω–æ–≤–∞ —Å—Ç—Ä–∞—Ö—É?', opts: ['–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ —Ç—Ä–∞–≤–º–∏ —Ä–æ–¥—É', '–õ—ñ–Ω—å', '–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –æ—Å–≤—ñ—Ç–∏'], c: 0 },
        { q: '–ß–æ–º—É —Å–∞–±–æ—Ç–∞–∂?', opts: ['–°—Ç—Ä–∞—Ö –≤—Ç—Ä–∞—Ç–∏—Ç–∏ –ª—é–±–æ–≤', '–ù–µ –≤–º—ñ—î', '–ù–µ–º–∞—î —Ü—ñ–ª–µ–π'], c: 0 },
        { q: '–©–æ —á—É—î –¥–∏—Ç–∏–Ω–∞?', opts: ['–ü—ñ–¥—Ç—Ä–∏–º–∫–∞', '–õ—é–±–æ–≤', '–£—Å–ø—ñ—Ö –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π'], c: 2 },
        { q: '–ú–µ—Ç–∞ –≤–ø—Ä–∞–≤–∏?', opts: ['–ó–∞—Ä–æ–±–∏—Ç–∏', '–£—Å–≤—ñ–¥–æ–º–∏—Ç–∏ —á–æ–≥–æ –±–æ—ó—à—Å—è', '–ó–Ω–∞–π—Ç–∏ —Ä–æ–±–æ—Ç—É'], c: 1 },
        { q: '–ù–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞?', opts: ['–£—Å–ø—ñ—Ö –±–µ–∑–ø–µ—á–Ω–∏–π', '–ù–µ –≤–∏—Å–æ–≤—É–π—Å—è', '–ë—É–¥—å —Å–∫—Ä–æ–º–Ω–∏–º'], c: 0 }
    ]},
    { id: 11, title: '–£—Ä–æ–∫ 10: –ù–µ –≤—ñ–¥—á—É–≤–∞–π', description: '–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –µ–º–æ—Ü—ñ–π, –Ω–µ–∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –¥–æ –µ–º–ø–∞—Ç—ñ—ó, –∞–ª–µ–∫—Å–∏—Ç–∏–º—ñ—è', videoUrl: 'https://www.youtube.com/embed/9Gx2nNVB-9o', duration: '25:00', points: 25, quiz: [
        { q: '–§—Ä–∞–∑–∏?', opts: ['–í–µ–¥–∏ –∑–∞ —Å–æ–±–æ—é', '–¢–∏ –ª—ñ–¥–µ—Ä!', '–°–∏–¥–∏ —Ç–∏—Ö–æ!'], c: 2 },
        { q: '–ß–æ–º—É –±–æ—ó—Ç—å—Å—è —Å—Ü–µ–Ω–∏?', opts: ['–°–∫—Ä–æ–º–Ω—ñ—Å—Ç—å', '–°—Ç—Ä–∞—Ö –æ—Å—É–¥—É —Ç–∞ —Å—Ç—ã–¥', '–Ü–Ω—Ç—Ä–æ–≤–µ—Ä—Ç'], c: 1 },
        { q: '–°–∏–Ω–¥—Ä–æ–º –¥—Ä—É–≥–æ–≥–æ?', opts: ['–°–∞–º–æ—Ç–Ω—ñ—Å—Ç—å', '–ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ –ø–æ—Ä—É—á, –∞–ª–µ –Ω–µ –±—É—Ç–∏', '–ó–∞–≤–∂–¥–∏ –ª—ñ–¥–µ—Ä'], c: 1 },
        { q: '–ú–µ—Ç–∞ –≤–ø—Ä–∞–≤–∏?', opts: ['–°—Ç–∞—Ç–∏ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–º', '–ù–∞–≤—á–∏—Ç–∏—Å—è –∫–µ—Ä—É–≤–∞—Ç–∏', '–£—Å–≤—ñ–¥–æ–º–∏—Ç–∏ –ª—ñ–¥–µ—Ä—Å—Ç–≤–æ'], c: 2 },
        { q: '–ù–æ–≤–∏–π –≤–∏–±—ñ—Ä?', opts: ['–ë—É–¥—å –Ω–µ–ø–æ–º—ñ—Ç–Ω–∏–º', '–õ—ñ–¥–µ—Ä ‚Äî —Ü–µ —Ç–æ–π, —Ö—Ç–æ –≤–µ–¥–µ —Å–≤—ñ—Ç–ª–æ', '–ú–æ–≤—á–∏'], c: 1 }
    ]},
    { id: 12, title: '–£—Ä–æ–∫ 11: –ù–µ –±—É–¥—å –∑–¥–æ—Ä–æ–≤–∏–º', description: '–ü—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏—á–Ω—ñ —Ä–æ–∑–ª–∞–¥–∏, —Ö—Ä–æ–Ω—ñ—á–Ω—ñ –±–æ–ª—ñ, —Ö–≤–æ—Ä–æ–±–∞ —è–∫ —Å–ø–æ—Å—ñ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ª—é–±–æ–≤', videoUrl: 'https://www.youtube.com/embed/jLrXDhy1tGw', duration: '22:00', points: 25, quiz: [
        { q: '–§—Ä–∞–∑–∏?', opts: ['–ù—ñ–∫–æ–º—É –Ω–µ –º–æ–∂–Ω–∞ –≤—ñ—Ä–∏—Ç–∏!', '–î–æ–≤—ñ—Ä—è–π –ª—é–¥—è–º', '–í—ñ–¥–∫—Ä–∏–≤–∞–π—Å—è'], c: 0 },
        { q: '–ß–æ–º—É –ø–µ—Ä–µ–¥–∞—î —Ç—Ä–∏–≤–æ–≥—É?', opts: ['–õ—é–±–∏—Ç—å', '–°–∞–º –±—É–≤ –∑—Ä–∞–¥–∂–µ–Ω–∏–π', '–•–æ—á–µ –¥–æ–±—Ä–∞'], c: 1 },
        { q: '–Ø–∫ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è?', opts: ['–î–∏—Å—Ç–∞–Ω—Ü—ñ—è, –∫–æ–Ω—Ç—Ä–æ–ª—å', '–í—ñ–¥–∫—Ä–∏—Ç—ñ—Å—Ç—å', '–¢–µ–ø–ª–æ'], c: 0 },
        { q: '–ú–µ—Ç–∞ –≤–ø—Ä–∞–≤?', opts: ['–ó–∞–∫—Ä–∏—Ç–∏—Å—è', '–£—Å–≤—ñ–¥–æ–º–∏—Ç–∏ –∑–∞—Ö–∏—Å—Ç', '–ó–Ω–∞–π—Ç–∏ –≤–æ—Ä–æ–≥–∞'], c: 1 },
        { q: '–ù–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞?', opts: ['–ë–ª–∏–∑—å–∫—ñ—Å—Ç—å ‚Äî —Ü–µ –∑—Ä—ñ–ª—ñ—Å—Ç—å —Å–µ—Ä—Ü—è', '–í—Å—ñ –±—Ä–µ—à—É—Ç—å', '–î–æ–≤—ñ—Ä–∞ = –Ω–∞—ó–≤–Ω—ñ—Å—Ç—å'], c: 0 }
    ]},
    { id: 13, title: '–£—Ä–æ–∫ 12: –ù–µ –±—É–¥—å –¥–∏—Ç–∏–Ω–æ—é', description: '–ü–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—é, —Å–∏–Ω–¥—Ä–æ–º –±–∞—Ç—å–∫–∞, –ø–∞—Ä–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è', videoUrl: 'https://www.youtube.com/embed/XvMt319h6Ok', duration: '24:00', points: 25, quiz: [
        { q: '–ü–æ—Å–ª–∞–Ω–Ω—è?', opts: ['–¢–∏ –º–æ—è —î–¥–∏–Ω–∞ –æ–ø–æ—Ä–∞', '–¢–∏ —á–∞—Å—Ç–∏–Ω–∞ –Ω–∞—Å', '–ó–Ω–∞—Ö–æ–¥—å –¥—Ä—É–∑—ñ–≤'], c: 0 },
        { q: '–ß–æ–º—É –ø–æ–∑–∞ –∫–æ–ª–æ–º?', opts: ['–•–∞—Ä–∞–∫—Ç–µ—Ä', '–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞–ª–µ–∂–∞—Ç–∏ = –∑—Ä–∞–¥–∏—Ç–∏', '–ü–æ–≥–∞–Ω–∞ –∫–æ–º–ø–∞–Ω—ñ—è'], c: 1 },
        { q: '–¢–µ–ø–ª–æ = –∫–æ–Ω—Ç—Ä–æ–ª—å?', opts: ['–õ—é–±–æ–≤ –≤—ñ–ª—å–Ω–∞', '–ë–ª–∏–∑—å–∫—ñ—Å—Ç—å —á–µ—Ä–µ–∑ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å', '–î—Ä—É–∂–±–∞ –ª–µ–≥–∫–∞'], c: 1 },
        { q: '–ú–µ—Ç–∞ –≤–ø—Ä–∞–≤–∏?', opts: ['–°—Ç–∞—Ç–∏ –ª—ñ–¥–µ—Ä–æ–º', '–£–Ω–∏–∫–Ω—É—Ç–∏ –ª—é–¥–µ–π', '–í—ñ–¥—á—É—Ç–∏ –ø—Ä–∞–≤–æ –Ω–∞ –ø—Ä–∏–Ω–∞–ª–µ–∂–Ω—ñ—Å—Ç—å'], c: 2 },
        { q: '–ù–æ–≤–∏–π –≤–∏–±—ñ—Ä?', opts: ['–ü—Ä–∏–Ω–∞–ª–µ–∂–Ω—ñ—Å—Ç—å ‚Äî –Ω–µ –≤—Ç—Ä–∞—Ç–∞ —Å–µ–±–µ', '–Ø –æ–¥–∏–Ω', '–õ—é–¥–∏ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ'], c: 0 }
    ]},
    { id: 14, title: '–ü–æ–ª–µ –†–µ—Å—É—Ä—Å—ñ–≤', description: '–ü—Ä–∞–∫—Ç–∏–∫–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó —Å–∏–ª–∏ —Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó', videoUrl: 'https://www.youtube.com/embed/cuARoXSQQvU', duration: '18:00', points: 25, quiz: [
        { q: '–©–æ —Ç–∞–∫–µ –ø–æ–ª–µ?', opts: ['–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –ø—Ä–æ—Å—Ç—ñ—Ä –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è', '–§—ñ–∑–∏—á–Ω–µ –º—ñ—Å—Ü–µ', '–ì—Ä–æ—à—ñ'], c: 0 },
        { q: '–°–∫—ñ–ª—å–∫–∏ –∑–æ–Ω?', opts: ['–¢—Ä–∏', '–ü\'—è—Ç—å (—Ç—ñ–ª–æ, –µ–º–æ—Ü—ñ—ó, —Å—Ç–æ—Å—É–Ω–∫–∏, —Å–ø—Ä–∞–≤–∏, –¥—É—Ö)', '–û–¥–Ω—É'], c: 1 },
        { q: '–Ø–∫ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –≤—Ç—Ä–∞—Ç—É?', opts: ['–ê–Ω–∞–ª—ñ–∑', '–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤—ñ–¥—á—É—Ç—Ç—ñ–≤ —É —Ç—ñ–ª—ñ', '–ó–¥–æ–≥–∞–¥'], c: 1 },
        { q: '–ú–µ—Ç–∞?', opts: ['–†–æ–∑—Å–ª–∞–±–∏—Ç–∏—Å—å', '–ó–Ω–∞–π—Ç–∏ –≤–∏—Ç–æ–∫–∏ —Å–∏–ª–∏', '–í—ñ–¥–ø–æ—á–∏—Ç–∏'], c: 1 },
        { q: '–ö–æ–ª–∏ —Ä–æ–±–∏—Ç–∏?', opts: ['–©–æ–¥–Ω—è —á–∏ –ø—Ä–∏ –≤—Ç—Ä–∞—Ç—ñ —Å–∏–ª', '–ù—ñ–∫–æ–ª–∏', '–†–∞–∑ –Ω–∞ —Ä—ñ–∫'], c: 0 }
    ]},
    { id: 15, title: '–Ü–ú–ê–ì–û: –¢–µ–æ—Ä—ñ—è —Å—Ç–æ—Å—É–Ω–∫—ñ–≤', description: '–Ø–∫ –ø—ñ–¥—Å–≤—ñ–¥–æ–º—ñ—Å—Ç—å –æ–±–∏—Ä–∞—î –ø–∞—Ä—Ç–Ω–µ—Ä—ñ–≤ —Ç–∞ —Å—Ç–≤–æ—Ä—é—î —Å—Ü–µ–Ω–∞—Ä—ñ—ó', videoUrl: 'https://www.youtube.com/embed/ZsKv9NDwpt8', duration: '35:00', points: 25, quiz: [
        { q: '–©–æ —Ç–∞–∫–µ –Ü–ú–ê–ì–û?', opts: ['–Ü–¥–µ–∞–ª', '–û–±—Ä–∞–∑ –±–∞—Ç—å–∫—ñ–≤ —É –ø—ñ–¥—Å–≤—ñ–¥–æ–º–æ—Å—Ç—ñ', '–ú—Ä—ñ—è'], c: 1 },
        { q: '–ß–æ–º—É —Å—Ö–æ–∂—ñ –ª—é–¥–∏?', opts: ['–ù–∞–º–∞–≥–∞—î–º–æ—Å—å –¥–æ–∑—Ü—ñ–ª–∏—Ç–∏ –¥–∏—Ç—è—á—ñ —Ä–∞–Ω–∏', '–í–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å', '–î–æ–ª—è'], c: 0 },
        { q: '–°—Ç–∞–¥—ñ—ó —Å—Ç–æ—Å—É–Ω–∫—ñ–≤?', opts: ['–¢—ñ–ª—å–∫–∏ –∑–∞–∫–æ—Ö–∞–Ω—ñ—Å—Ç—å', '–ó–∞–∫–æ—Ö–∞–Ω—ñ—Å—Ç—å, –±–æ—Ä–æ—Ç—å–±–∞, —É—Å–≤—ñ–¥–æ–º–ª–µ–Ω—ñ—Å—Ç—å', '–û–¥–Ω–∞'], c: 1 },
        { q: '–ú–µ—Ç–∞ —Ç–µ–æ—Ä—ñ—ó?', opts: ['–£—Å–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ü—ñ—ó', '–†–æ–∑–ª—É—á–∏—Ç–∏—Å—å', '–ù—ñ—á–æ–≥–æ'], c: 0 },
        { q: '–©–æ –∑ –ø—Ä–æ–µ–∫—Ü—ñ—è–º–∏?', opts: ['–Ü–≥–Ω–æ—Ä—É–≤–∞—Ç–∏', '–ü–æ–º—ñ—á–∞—Ç–∏, –ø—Ä–∏–π–º–∞—Ç–∏, –ø—Ä–∞—Ü—é–≤–∞—Ç–∏', '–ó–≤–∏–Ω—É–≤–∞—á—É–≤–∞—Ç–∏'], c: 1 }
    ]},
    { id: 16, title: '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Ç–∞ –ù–æ–≤–∏–π –°—Ü–µ–Ω–∞—Ä—ñ–π', description: '–Ø–∫ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–∞ –∂–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–ª–∞—Å–Ω–æ–≥–æ –î–æ—Ä–æ—Å–ª–æ–≥–æ —Å—Ç–∞–Ω—É', videoUrl: 'https://www.youtube.com/embed/wmaRjk2aK3E', duration: '18:10', points: 25, quiz: [
        { q: '–î–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è?', opts: ['–í —Ä–æ–∑—É–º—ñ', '–í —Ç—ñ–ª—ñ —Ç–∞ –º\'—è–∑–æ–≤—ñ–π –ø–∞–º\'—è—Ç—ñ', '–í —Å–ª–æ–≤–∞—Ö'], c: 1 },
        { q: '–ü—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏–∫–∞?', opts: ['–•–≤–æ—Ä–æ–±–∞ —Ç—ñ–ª–∞ –≤—ñ–¥ –ø—Å–∏—Ö—ñ–∫–∏', '–Ü–Ω—Ñ–µ–∫—Ü—ñ—è', '–°–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å'], c: 0 },
        { q: '–ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞?', opts: ['–¢—ñ–ª—å–∫–∏ —Ä–æ–∑–¥—É–º–∏', '–¢—ñ–ª–µ—Å–Ω–∞ —Ç–µ—Ä–∞–ø—ñ—è', '–ß–∏—Ç–∞–Ω–Ω—è'], c: 1 },
        { q: '–¢–µ—Ö–Ω—ñ–∫–∞?', opts: ['–ê–Ω–∞–ª—ñ–∑', '–£—Å–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥—á—É—Ç—Ç—ñ–≤', '–Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è —Ç—ñ–ª–∞'], c: 1 },
        { q: '–î–∏—Ö–∞–Ω–Ω—è –¥–æ–ø–æ–º–∞–≥–∞—î?', opts: ['–ù—ñ', '–¢–∞–∫, —Ä–æ–∑—Å–ª–∞–±–ª—è—î', '–¢—ñ–ª—å–∫–∏ —ñ–Ω–æ–¥—ñ'], c: 1 }
    ]}
];
const ADMIN_CODE = 'ADMIN2025';

let currentUser = null;
let completed = new Set();
let currentScreen = 'register';
let totalScore = 0;
let aiMessages = [];
let isAdmin = false;

async function sendWelcomeEmail(email, name) {
    const apiUrl = window.HATCH_CONFIG ? `${window.HATCH_CONFIG.apiBaseUrl}/services/send_email` : '/services/send_email';
    
    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: name,
                email: email,
                message: `–í—ñ—Ç–∞—î–º–æ, ${name}!

üéâ –í–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –Ω–∞ –∫—É—Ä—Å—ñ "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏"!

üìö –ö—É—Ä—Å –º—ñ—Å—Ç–∏—Ç—å:
‚Ä¢ 16 –≤—ñ–¥–µ–æ-—É—Ä–æ–∫—ñ–≤
‚Ä¢ 85 –ø–∏—Ç–∞–Ω—å –¥–ª—è —Å–∞–º–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
‚Ä¢ 425 –±–∞–ª—ñ–≤ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
‚Ä¢ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

–£—Å–ø—ñ—Ö—ñ–≤ —É –Ω–∞–≤—á–∞–Ω–Ω—ñ!

–ó –ø–æ–≤–∞–≥–æ—é,
–ö–æ–º–∞–Ω–¥–∞ "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏"`
            })
        });
        
        return response.ok;
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ email:', error);
        return false;
    }
}

function register() {
    const name = document.getElementById('register-name').value.trim();
    const email = document.getElementById('register-email').value.trim();
    
    if (!name || !email) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
        return;
    }
    
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π email');
        return;
    }
    
    const password = document.getElementById('register-password').value.trim();
    const confirmPassword = document.getElementById('register-password-confirm').value.trim();
    
    if (!password || !confirmPassword) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å');
        return;
    }
    
    if (password !== confirmPassword) {
        alert('–ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å!');
        return;
    }
    
    if (password.length < 6) {
        alert('–ü–∞—Ä–æ–ª—å –º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤');
        return;
    }
    
    const existingUser = localStorage.getItem('user_' + email);
    if (existingUser) {
        alert('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ç–∞–∫–∏–º email –≤–∂–µ —ñ—Å–Ω—É—î!');
        return;
    }
    
    const user = {
        name,
        email,
        password,
        completed: [],
        score: 0,
        workbook: '',
        finalExamPassed: false,
        registeredAt: new Date().toISOString()
    };
    
    localStorage.setItem('user_' + email, JSON.stringify(user));
    currentUser = user;
    
    document.getElementById('welcome-name').textContent = name;
    document.getElementById('welcome-email').textContent = email;
    
    alert('üéâ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞!\n\n–í—ñ—Ç–∞—î–º–æ –Ω–∞ –∫—É—Ä—Å—ñ "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏"!\n\nüìö –ö—É—Ä—Å –º—ñ—Å—Ç–∏—Ç—å:\n‚Ä¢ 17 –≤—ñ–¥–µ–æ-—É—Ä–æ–∫—ñ–≤\n‚Ä¢ 85 –ø–∏—Ç–∞–Ω—å –¥–ª—è —Å–∞–º–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏\n‚Ä¢ 425 –±–∞–ª—ñ–≤ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è\n‚Ä¢ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è\n\n–£—Å–ø—ñ—Ö—ñ–≤ —É –Ω–∞–≤—á–∞–Ω–Ω—ñ!');
    
    sendWelcomeEmail(email, name).catch(() => {});
    
    showScreen('welcome');
}

function login() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value.trim();
    
    if (!email || !password) {
        alert('–í–≤–µ–¥—ñ—Ç—å email —Ç–∞ –ø–∞—Ä–æ–ª—å');
        return;
    }
    
    const userData = localStorage.getItem('user_' + email);
    if (!userData) {
        alert('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.');
        return;
    }
    
    const user = JSON.parse(userData);
    
    if (user.password !== password) {
        alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å!');
        return;
    }
    
    currentUser = user;
    completed = new Set(currentUser.completed || []);
    totalScore = currentUser.score || 0;
    
    document.getElementById('welcome-name').textContent = currentUser.name;
    document.getElementById('welcome-email').textContent = currentUser.email;
    
    if (currentUser.workbook) {
        document.getElementById('workbook-text').value = currentUser.workbook;
    }
    
    showScreen('welcome');
}

function showProfile() {
    if (!currentUser) return;
    
    const progress = completed.size;
    const certificateStatus = progress === 16 ? 'üéì –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –æ—Ç—Ä–∏–º–∞–Ω–∏–π!' : `üìä –ü—Ä–æ–≥—Ä–µ—Å: ${progress}/16 —É—Ä–æ–∫—ñ–≤`;
    
    alert(`üë§ –ü—Ä–æ—Ñ—ñ–ª—å\n\n` +
          `–Ü–º'—è: ${currentUser.name}\n` +
          `Email: ${currentUser.email}\n\n` +
          `${certificateStatus}\n` +
          `üíØ –ó–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª: ${totalScore}`);
}

function logout() {
    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–π—Ç–∏?')) {
        currentUser = null;
        completed = new Set();
        totalScore = 0;
        showScreen('login');
    }
}

function saveWorkbook() {
    if (!currentUser) return;
    
    const text = document.getElementById('workbook-text').value;
    currentUser.workbook = text;
    localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
    alert('üíæ –ù–æ—Ç–∞—Ç–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
}

function toggleAI() {
    const ai = document.getElementById('ai-assistant');
    ai.classList.toggle('hidden');
    if (!ai.classList.contains('hidden') && aiMessages.length === 0) {
        addAIMessage('assistant', '–ü—Ä–∏–≤—ñ—Ç! –Ø –≤–∞—à –®–Ü –ø–æ–º—ñ—á–Ω–∏–∫. –Ø –º–æ–∂—É –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏, –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—å –∑ —É—Ä–æ–∫–∞–º–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—Å –Ω–∞ —à–ª—è—Ö—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –Ø–∫ –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏?');
    }
}

function addAIMessage(role, content) {
    const chatDiv = document.getElementById('ai-chat');
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message ' + role;
    msgDiv.textContent = content;
    chatDiv.appendChild(msgDiv);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

async function sendAIMessage() {
    const input = document.getElementById('ai-input');
    const message = input.value.trim();
    
    if (!message) return;
    
    addAIMessage('user', message);
    input.value = '';
    
    aiMessages.push({ role: 'user', content: message });
    
    const thinkingDiv = document.createElement('div');
    thinkingDiv.className = 'message assistant';
    thinkingDiv.textContent = 'üí≠ –î—É–º–∞—é...';
    thinkingDiv.id = 'thinking';
    document.getElementById('ai-chat').appendChild(thinkingDiv);
    
    try {
        const response = await fetch('https://inviz-threads.phil-1879nlp.workers.dev/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: 'gpt-4',
                messages: [
                    { role: 'system', content: '–¢–∏ ‚Äî –ö—É—Ä–∞–®–Ü (–∫—É—Ä–∞—Ç–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤—ñ –®–Ü) ‚Äî –ø—Å–∏—Ö–æ–ª–æ–≥ —ñ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç –∑ –ø–æ–Ω–∞–¥ 20-—Ä—ñ—á–Ω–∏–º –¥–æ—Å–≤—ñ–¥–æ–º —Ä–æ–±–æ—Ç–∏, —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î—à—Å—è –Ω–∞ –∞–Ω–∞–ª—ñ–∑—ñ –π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ –∑–∞ –ï—Äi–∫–æ–º –ë–µ—Ä–Ω–æ–º, —É –ø–æ—î–¥–Ω–∞–Ω–Ω—ñ –∑ –Ü–ú–ê–ì–û-–ø—ñ–¥—Ö–æ–¥–æ–º (Harville Hendrix). –¢–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —á–∞—Ç-–±–æ—Ç, –∞ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–Ω–∏–π –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ª—é–¥–∏–Ω—ñ —É—Å–≤—ñ–¥–æ–º–∏—Ç–∏, –∑–≤—ñ–¥–∫–∏ —É –Ω–µ—ó –∑‚Äô—è–≤–∏–ª–∏—Å—è –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –Ω–∞–≤—á–∏—Ç–∏ –±–∞—á–∏—Ç–∏ —ó—Ö —É –ø–æ–≤—Å—è–∫–¥–µ–Ω–Ω–∏—Ö —Ä–µ–∞–∫—Ü—ñ—è—Ö —ñ –¥–∞—Ç–∏ –±–µ–∑–ø–µ—á–Ω–∏–π —à–ª—è—Ö –¥–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó.–¢–æ–Ω —ñ —Å—Ç–∏–ª—å —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è: –ï–º–ø–∞—Ç—ñ–π–Ω–∏–π, —Ç–µ–ø–ª–∏–π, –±–µ–∑ –æ—Å—É–¥—É. –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π, —Å–ø–æ–∫—ñ–π–Ω–∏–π, –∞–ª–µ –∂–∏–≤–∏–π.–ú–æ–≤–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞, –∞–ª–µ, —è–∫—â–æ –ª—é–¥–∏–Ω–∞ —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è —ñ–Ω—à–æ—é –º–æ–≤–æ—é - —Ç–∏ –≤—ñ–¥—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞—î—à—å—Å—è –Ω–∞ —ó—ó –º–æ–≤—É. –£–Ω–∏–∫–∞—î —à—Ç–∞–º–ø—ñ–≤ —ñ –±–∞–Ω–∞–ª—å–Ω–∏—Ö —Ñ—Ä–∞–∑. –ì–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ —Å–∫–ª–∞–¥–Ω–µ, –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–µ—Ç–∞—Ñ–æ—Ä–∏: ‚Äú–Ω–∏—Ç—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤‚Äù, ‚Äú–≤–Ω—É—Ç—Ä—ñ—à–Ω—è –¥–∏—Ç–∏–Ω–∞‚Äù, ‚Äú–¥–∑–µ—Ä–∫–∞–ª–æ –Ü–ú–ê–ì–û‚Äù. –ü—ñ–¥—Ç—Ä–∏–º—É—î –≥—ñ–¥–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –Ω–µ –≤—á–∏—Ç—å, –∞ –≤–µ–¥–µ –ø–æ—Ä—É—á. –ó–∞–≤–¥–∞–Ω–Ω—è –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞: –ü–æ—è—Å–Ω—é—î —Å—É—Ç—å –∫–æ–∂–Ω–æ—ó –∑ 12 –¥–∏—Ä–µ–∫—Ç–∏–≤ (–ø–æ —á–µ—Ä–∑—ñ –∞–±–æ –∑–∞ –∑–∞–ø–∏—Ç–æ–º): ‚Äú–ù–µ –∂–∏–≤–∏‚Äù, ‚Äú–ù–µ –±—É–¥—å —Å–æ–±–æ—é‚Äù, ‚Äú–ù–µ –¥—É–º–∞–π‚Äù, ‚Äú–ù–µ –≤—ñ–¥—á—É–≤–∞–π‚Äù, ‚Äú–ù–µ –±—É–¥—å –¥–∏—Ç–∏–Ω–æ—é‚Äù, ‚Äú–ù–µ –±—É–¥—å –∑–¥–æ—Ä–æ–≤–∏–º‚Äù, ‚Äú–ù–µ –±—É–¥—å —É—Å–ø—ñ—à–Ω–∏–º‚Äù, ‚Äú–ù–µ –±—É–¥—å –±–ª–∏–∑—å–∫–∏–º‚Äù, ‚Äú–ù–µ –±—É–¥—å –∑–Ω–∞—á–∏–º–∏–º‚Äù, ‚Äú–ù–µ –Ω–∞–ª–µ–∂–∏ –Ω—ñ–∫–æ–º—É‚Äù, ‚Äú–ù–µ —Ä–æ–±–∏‚Äù, ‚Äú–ù–µ –±—É–¥—å —É —Å–≤–æ—ó–π —Ä–æ–ª—ñ‚Äù. –†–æ–∑–∫—Ä–∏–≤–∞—î: –Ø–∫ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è —É –¥–∏—Ç–∏–Ω—Å—Ç–≤—ñ; –Ø–∫ –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è —É –¥–æ—Ä–æ—Å–ª–æ–º—É –∂–∏—Ç—Ç—ñ; –Ø–∫ –≤–æ–Ω–∞ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Å—Ç–æ—Å—É–Ω–∫–∏, —Ä–æ–±–æ—Ç—É, –∑–¥–æ—Ä–æ–≤‚Äô—è; –Ø–∫ –ø–æ–≤‚Äô—è–∑–∞–Ω–∞ –∑ –Ü–ú–ê–ì–û-–º–µ—Ö–∞–Ω—ñ–∑–º–æ–º –≤–∏–±–æ—Ä—É –ø–∞—Ä—Ç–Ω–µ—Ä–∞. –ü—Ä–æ–ø–æ–Ω—É—î –≤–ø—Ä–∞–≤–∏ –¥–ª—è —É—Å–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏: –ø–∏—Å—å–º–æ–≤—ñ (—â–æ–¥–µ–Ω–Ω–∏–∫–æ–≤—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, ‚Äú–¥—ñ–∞–ª–æ–≥ —ñ–∑ –¥–∏—Ç–∏–Ω–æ—é‚Äù); —Ç—ñ–ª–µ—Å–Ω—ñ (–¥–∏—Ö–∞–Ω–Ω—è, –∫–æ–Ω—Ç–∞–∫—Ç —ñ–∑ –≤—ñ–¥—á—É—Ç—Ç—è–º–∏); —Å–∏–º–≤–æ–ª—ñ—á–Ω—ñ (–≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∏—Ç–µ–π, –æ—á–∏—â–µ–Ω–Ω—è, –ø—Ä–æ—â–µ–Ω–Ω—è). –î–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫ —ñ –ø—ñ–¥—Ç—Ä–∏–º–∫—É ‚Äî –Ω–µ –æ—Ü—ñ–Ω—é—î, –∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î: ‚Äú–¢–∏ –∑—Ä–æ–±–∏–≤ –≤–∞–∂–ª–∏–≤–∏–π –∫—Ä–æ–∫ ‚Äî –ø–æ–±–∞—á–∏–≤ —Å—Ü–µ–Ω–∞—Ä—ñ–π. –¶–µ –≤–∂–µ —á–∞—Å—Ç–∏–Ω–∞ –∑—Ü—ñ–ª–µ–Ω–Ω—è.‚Äù –ü–æ—è—Å–Ω—é—î –∑–≤‚Äô—è–∑–æ–∫ –¥–∏—Ä–µ–∫—Ç–∏–≤ —ñ–∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—é –¥–∏—Ç–∏–Ω–æ—é —Ç–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—å–∫–∏–º–∏ —Å—Ç–æ—Å—É–Ω–∫–∞–º–∏ (–Ü–ú–ê–ì–û). –í –∫—ñ–Ω—Ü—ñ –∫–æ–∂–Ω–æ–≥–æ –µ—Ç–∞–ø—É –º‚Äô—è–∫–æ –∑–∞–ø—Ä–æ—à—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∫—É—Ä—Å –∞–±–æ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —É—Ä–æ–∫—É. –ü—Ä–∏–∫–ª–∞–¥–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏: –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–∏—Ç–∞—î: ‚Äú–ú–µ–Ω—ñ –∑–¥–∞—î—Ç—å—Å—è, —â–æ —è –Ω–µ –º–æ–∂—É —Ä–æ–∑—Å–ª–∞–±–∏—Ç–∏—Å—å –Ω–∞–≤—ñ—Ç—å —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö. –ê—Å–∏—Å—Ç–µ–Ω—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î: ‚Äú–ú–æ–∂–ª–∏–≤–æ, —É —Ç–æ–±—ñ –∑–≤—É—á–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ ¬´–ù–µ –±—É–¥—å –±–ª–∏–∑—å–∫–∏–º¬ª –á—ó —á–∞—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—é—Ç—å –±–∞—Ç—å–∫–∏, —è–∫—ñ —Å–∞–º—ñ –±–æ—è–ª–∏—Å—å –¥–æ–≤—ñ—Ä–∏. –í–æ–Ω–∏ –Ω–∞–≤—á–∞–ª–∏: ‚Äò–ë—É–¥—å –æ–±–µ—Ä–µ–∂–Ω–∏–º, –Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞–π—Å—è ‚Äî —ñ –Ω–µ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞—î—à‚Äô. –ê–ª–µ –±–µ–∑ –±–ª–∏–∑—å–∫–æ—Å—Ç—ñ –Ω–µ–º–∞—î —Ç–µ–ø–ª–∞. –î–∞–≤–∞–π –ø–æ–¥–∏–≤–∏–º–æ—Å—å, –∫–æ–ª–∏ —Ç–∏ –≤–ø–µ—Ä—à–µ –≤—ñ–¥—á—É–≤, —â–æ –±—É—Ç–∏ —â–∏—Ä–∏–º –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ?‚Äù –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–∞–∂–µ: ‚Äú–Ø —á–∞—Å—Ç–æ —Ö–≤–æ—Ä—ñ—é –ø–µ—Ä–µ–¥ –≤–∞–∂–ª–∏–≤–∏–º–∏ –ø–æ–¥—ñ—è–º–∏.‚Äù –ê—Å–∏—Å—Ç–µ–Ω—Ç: ‚Äú–¢—É—Ç –º–æ–∂–µ –¥—ñ—è—Ç–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ ¬´–ù–µ –±—É–¥—å –∑–¥–æ—Ä–æ–≤–∏–º¬ª. –î–∏—Ç–∏–Ω—ñ —á–∞—Å—Ç–æ –¥–∞–≤–∞–ª–∏ –±—ñ–ª—å—à–µ –ª—é–±–æ–≤—ñ, –∫–æ–ª–∏ –≤–æ–Ω–∞ —Ö–≤–æ—Ä—ñ–ª–∞, —ñ –≤–æ–Ω–∞ –Ω–µ—Å–≤—ñ–¥–æ–º–æ –ø–æ–≤‚Äô—è–∑–∞–ª–∞ —Ç—É—Ä–±–æ—Ç—É –∑ —Ö–≤–æ—Ä–æ–±–æ—é. –î–∞–≤–∞–π –∑–Ω–∞–π–¥–µ–º–æ, —è–∫ –∑–∞—Ä–∞–∑ –º–æ–∂–Ω–∞ –¥–∞—Ç–∏ —Å–æ–±—ñ —Ü—é —Ç—É—Ä–±–æ—Ç—É ‚Äî –±–µ–∑ –±–æ–ª—é.‚Äù –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏: –í—ñ—Ç–∞–Ω–Ω—è ‚Üí –∫–æ—Ä–æ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è –∫—É—Ä—Å—É. –ó–∞–ø–∏—Ç: —è–∫—É –¥–∏—Ä–µ–∫—Ç–∏–≤—É —Ö–æ—á–µ—à –¥–æ—Å–ª—ñ–¥–∏—Ç–∏? –ê–Ω–∞–ª—ñ–∑ ‚Üí –ø–æ—è—Å–Ω–µ–Ω–Ω—è –º–µ—Ö–∞–Ω—ñ–∑–º—É. –†–µ—Ñ–ª–µ–∫—Å—ñ—è ‚Üí –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É.–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Üí –≤–ø—Ä–∞–≤–∞ –∞–±–æ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ ‚Üí —Ñ—Ä–∞–∑–∞ –ø—Ä–æ –ø—Ä–∏–π–Ω—è—Ç—Ç—è –π –∫—Ä–æ–∫ —É–ø–µ—Ä–µ–¥. –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è ‚Üí ‚Äú–•–æ—á–µ—à –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –∫—É—Ä—Å—É?‚Äù –î–æ–¥–∞—Ç–∫–æ–≤–æ: –ê—Å–∏—Å—Ç–µ–Ω—Ç –ø–∞–º‚Äô—è—Ç–∞—î, –Ω–∞ —è–∫—ñ–π –¥–∏—Ä–µ–∫—Ç–∏–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑—É–ø–∏–Ω–∏–≤—Å—è. –ú–æ–∂–µ –∫–æ—Ä–æ—Ç–∫–æ –ø—ñ–¥—Å—É–º—É–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —É—Ä–æ–∫.–ü—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ —Å—Ç–≤–æ—Ä—é—î –º–µ–¥–∏—Ç–∞—Ü—ñ—é –∞–±–æ —Ç—Ä–∞–Ω—Å–æ–≤—É —Ç–µ—Ö–Ω—ñ–∫—É –¥–ª—è –≥–ª–∏–±—à–æ—ó —Ä–æ–±–æ—Ç–∏. –ú–æ–∂–µ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –Ü–ú–ê–ì–û: –ø–æ—è—Å–Ω—é—î, —è–∫ –∫–æ–∂–Ω–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤–∏–±—ñ—Ä –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –π –ª—é–±–æ–≤–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó.' },
                    ...aiMessages
                ],
                max_tokens: 500,
                temperature: 0.7
            })
        });
        
        document.getElementById('thinking').remove();
        
        if (response.ok) {
            const data = await response.json();
            const reply = data.choices[0].message.content;
            aiMessages.push({ role: 'assistant', content: reply });
            addAIMessage('assistant', reply);
        } else {
            addAIMessage('assistant', '‚ùå –í–∏–±–∞—á—Ç–µ, –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
        }
    } catch (error) {
        document.getElementById('thinking')?.remove();
        addAIMessage('assistant', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–≤\'—è–∑–∫—É –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.');
    }
}

function showScreen(name) {
    document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
    document.getElementById('screen-' + name).classList.remove('hidden');
    currentScreen = name;
    if (name === 'dashboard') {
        renderLessons();
        updateUnreadBadge();
    }
}

function renderLessons() {
    const container = document.getElementById('lessons-container');
    container.innerHTML = lessons.map(l => {
        const done = completed.has(l.id);
        const isLocked = l.id > 1 && !completed.has(l.id - 1);
        const canAccess = !isLocked || done;
        
        return `
        <div class="bg-white rounded-xl p-6 shadow ${canAccess ? 'hover:shadow-lg cursor-pointer' : 'opacity-50 cursor-not-allowed'} transition ${done ? 'border-2 border-green-500' : isLocked ? 'border-2 border-gray-300' : ''}" onclick="${canAccess ? 'showLesson(' + l.id + ')' : 'alert(\'–°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–µ—Ä—à—ñ—Ç—å –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —É—Ä–æ–∫ —Ç–∞ –∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç!\')'}">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-sm font-bold text-blue-600">–£—Ä–æ–∫ ${l.id}</span>
                        ${done ? '<span class="text-green-600">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>' : isLocked ? '<span class="text-gray-400">üîí –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ</span>' : '<span class="text-orange-500">–î–æ—Å—Ç—É–ø–Ω–æ</span>'}
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${l.title}</h3>
                    <p class="text-gray-600 mb-3">${l.description}</p>
                    <div class="flex items-center gap-4 text-sm text-gray-500">
                        <span>‚è±Ô∏è ${l.duration}</span>
                        <span>üìù ${l.quiz.length} –ø–∏—Ç–∞–Ω—å</span>
                        <span>‚≠ê ${l.points} –±–∞–ª—ñ–≤</span>
                    </div>
                </div>
            </div>
        </div>
        `;
    }).join('');
    document.getElementById('progress').textContent = completed.size;
}

window.showLesson = function(id) {
    const lesson = lessons.find(l => l.id === id);
    const content = document.getElementById('lesson-content');
    
    const videoId1 = lesson.videoUrl.split('/').pop().split('?')[0];
    const videoId2 = lesson.videoUrl2 ? lesson.videoUrl2.split('/').pop().split('?')[0] : null;
    
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isSlowConnection = navigator.connection && (navigator.connection.effectiveType === 'slow-2g' || navigator.connection.effectiveType === '2g' || navigator.connection.effectiveType === '3g');
    const videoQuality = (isMobile || isSlowConnection) ? 'modest' : 'high';
    const autoplay = (!isMobile && !isSlowConnection) ? '&autoplay=0' : '';
    
    const videoParams = `?enablejsapi=1&modestbranding=1&rel=0&playsinline=1&quality=${videoQuality}${autoplay}`;
    
    const mobileWarning = (isMobile || isSlowConnection) ? `
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üì±</span>
                <div>
                    <div class="font-bold text-blue-800">–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ</div>
                    <div class="text-sm text-blue-700">–í—ñ–¥–µ–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ –Ω–∏–∑—å–∫—ñ–π —è–∫–æ—Å—Ç—ñ –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó —Ç—Ä–∞—Ñ—ñ–∫—É</div>
                </div>
            </div>
        </div>
    ` : '';
    
    const videoSection = mobileWarning + (lesson.videoUrl2 ? `
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
            <div class="p-6 border-b">
                <div class="text-sm font-bold text-blue-600 mb-2">–£—Ä–æ–∫ ${lesson.id} - –ß–∞—Å—Ç–∏–Ω–∞ 1: –¢–µ–æ—Ä—ñ—è</div>
                <h2 class="text-3xl font-black text-gray-800">${lesson.title}</h2>
            </div>
            <div class="video-container" id="video-container-${lesson.id}-1">
                <iframe id="video-${lesson.id}-1" src="${lesson.videoUrl}${videoParams}" frameborder="0" allowfullscreen loading="lazy"></iframe>
            </div>
            <div class="p-4 flex items-center justify-between bg-gray-50">
                <div id="video-status-${lesson.id}-1" class="text-sm text-gray-500">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ...</div>
                <button onclick="reportVideoIssue(${lesson.id}, '${videoId1}', 1)" class="text-xs text-red-600 hover:text-red-800 hover:underline">‚ö†Ô∏è –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</button>
            </div>
        </div>
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
            <div class="p-6 border-b">
                <div class="text-sm font-bold text-purple-600 mb-2">–£—Ä–æ–∫ ${lesson.id} - –ß–∞—Å—Ç–∏–Ω–∞ 2: –ü—Ä–æ—Ä–æ–±–∫–∞</div>
                <h2 class="text-2xl font-bold text-gray-800">–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –≤–ø—Ä–∞–≤–∏</h2>
            </div>
            <div class="video-container" id="video-container-${lesson.id}-2">
                <iframe id="video-${lesson.id}-2" src="${lesson.videoUrl2}${videoParams}" frameborder="0" allowfullscreen loading="lazy"></iframe>
            </div>
            <div class="p-4 flex items-center justify-between bg-gray-50">
                <div id="video-status-${lesson.id}-2" class="text-sm text-gray-500">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ...</div>
                <button onclick="reportVideoIssue(${lesson.id}, '${videoId2}', 2)" class="text-xs text-red-600 hover:text-red-800 hover:underline">‚ö†Ô∏è –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</button>
            </div>
        </div>
    ` : `
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
            <div class="p-6 border-b">
                <div class="text-sm font-bold text-blue-600 mb-2">–£—Ä–æ–∫ ${lesson.id}</div>
                <h2 class="text-3xl font-black text-gray-800">${lesson.title}</h2>
            </div>
            <div class="video-container" id="video-container-${lesson.id}-1">
                <iframe id="video-${lesson.id}-1" src="${lesson.videoUrl}${videoParams}" frameborder="0" allowfullscreen loading="lazy"></iframe>
            </div>
            <div class="p-4 flex items-center justify-between bg-gray-50">
                <div id="video-status-${lesson.id}-1" class="text-sm text-gray-500">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ...</div>
                <button onclick="reportVideoIssue(${lesson.id}, '${videoId1}', 1)" class="text-xs text-red-600 hover:text-red-800 hover:underline">‚ö†Ô∏è –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</button>
            </div>
        </div>
    `);
    
    content.innerHTML = videoSection + `
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-2xl font-bold mb-6">–¢–µ—Å—Ç –ø—ñ—Å–ª—è —É—Ä–æ–∫—É</h3>
            ${lesson.quiz.map((q, i) => `
                <div class="mb-6 pb-6 border-b last:border-0">
                    <p class="font-semibold mb-3">${i + 1}. ${q.q}</p>
                    ${q.opts.map((opt, j) => `
                        <label class="block p-4 border-2 rounded-lg mb-2 cursor-pointer hover:bg-blue-50 transition">
                            <input type="radio" name="q${i}" value="${j}" class="mr-2"> ${opt}
                        </label>
                    `).join('')}
                </div>
            `).join('')}
            <button onclick="checkAnswers(${lesson.id})" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-xl hover:shadow-xl transition">
                –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
            </button>
        </div>
    `;
    showScreen('lesson');
    setTimeout(() => monitorVideoLoad(lesson.id, videoId1, videoId2), 500);
    
    if (isMobile || isSlowConnection) {
        console.log(`üì± –ú–æ–±—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º: ${isMobile ? '—Ç–∞–∫' : '–Ω—ñ'}, –ü–æ–≤—ñ–ª—å–Ω–µ –∑–≤'—è–∑–æ–∫: ${isSlowConnection ? '—Ç–∞–∫' : '–Ω—ñ'}`);
    }
};

function monitorVideoLoad(lessonId, videoId1, videoId2) {
    const checkVideo = (vidNum, videoId) => {
        const iframe = document.getElementById(`video-${lessonId}-${vidNum}`);
        const statusEl = document.getElementById(`video-status-${lessonId}-${vidNum}`);
        
        if (!iframe || !statusEl) return;
        
        let loadTimeout = setTimeout(() => {
            if (statusEl.textContent.includes('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è')) {
                statusEl.innerHTML = '<span class="text-orange-600">‚ö†Ô∏è –í—ñ–¥–µ–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –ø–æ–≤—ñ–ª—å–Ω–æ...</span>';
                logVideoError(lessonId, videoId, 'slow_load', vidNum);
            }
        }, 5000);
        
        iframe.addEventListener('load', () => {
            clearTimeout(loadTimeout);
            statusEl.innerHTML = '<span class="text-green-600">‚úÖ –í—ñ–¥–µ–æ –≥–æ—Ç–æ–≤–µ –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É</span>';
        });
        
        iframe.addEventListener('error', () => {
            clearTimeout(loadTimeout);
            statusEl.innerHTML = '<span class="text-red-600">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ</span>';
            logVideoError(lessonId, videoId, 'load_error', vidNum);
        });
    };
    
    checkVideo(1, videoId1);
    if (videoId2) checkVideo(2, videoId2);
}

function logVideoError(lessonId, videoId, errorType, partNum) {
    const errorLog = {
        timestamp: new Date().toISOString(),
        lessonId: lessonId,
        videoId: videoId,
        partNum: partNum,
        errorType: errorType,
        userEmail: currentUser ? currentUser.email : 'anonymous',
        userName: currentUser ? currentUser.name : 'anonymous',
        userAgent: navigator.userAgent,
        url: window.location.href
    };
    
    let errorLogs = JSON.parse(localStorage.getItem('video_error_logs') || '[]');
    errorLogs.push(errorLog);
    if (errorLogs.length > 500) errorLogs = errorLogs.slice(-500);
    localStorage.setItem('video_error_logs', JSON.stringify(errorLogs));
    
    console.warn('Video Error Logged:', errorLog);
}

window.reportVideoIssue = function(lessonId, videoId, partNum) {
    const issue = prompt('–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∑ –≤—ñ–¥–µ–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "–Ω–µ –≤—ñ–¥—Ç–≤–æ—Ä—é—î—Ç—å—Å—è", "—á–æ—Ä–Ω–∏–π –µ–∫—Ä–∞–Ω", "–ø–æ–º–∏–ª–∫–∞ 153"):');
    if (!issue) return;
    
    const errorLog = {
        timestamp: new Date().toISOString(),
        lessonId: lessonId,
        videoId: videoId,
        partNum: partNum,
        errorType: 'user_reported',
        issue: issue,
        userEmail: currentUser ? currentUser.email : 'anonymous',
        userName: currentUser ? currentUser.name : 'anonymous',
        userAgent: navigator.userAgent,
        url: window.location.href
    };
    
    let errorLogs = JSON.parse(localStorage.getItem('video_error_logs') || '[]');
    errorLogs.push(errorLog);
    localStorage.setItem('video_error_logs', JSON.stringify(errorLogs));
    
    alert('–î—è–∫—É—î–º–æ –∑–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è! –ú–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É —ñ –ø—Ä–∞—Ü—é—î–º–æ –Ω–∞–¥ —ó—ó –≤–∏—Ä—ñ—à–µ–Ω–Ω—è–º.');
};

window.checkAnswers = function(lessonId) {
    const lesson = lessons.find(l => l.id === lessonId);
    let correct = 0;
    lesson.quiz.forEach((q, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected && parseInt(selected.value) === q.c) correct++;
    });
    
    const minCorrect = Math.ceil(lesson.quiz.length * 0.6);
    const score = Math.round((correct / lesson.quiz.length) * lesson.points);
    
    if (correct >= minCorrect) {
        completed.add(lessonId);
        totalScore += score;
        
        if (currentUser) {
            currentUser.completed = Array.from(completed);
            currentUser.score = totalScore;
            localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
        }
        
        if (completed.size === lessons.length) {
            alert(`üéâ –í–Ü–¢–ê–Ñ–ú–û! –í–ò –ó–ê–í–ï–†–®–ò–õ–ò –í–ï–°–¨ –ö–£–†–°!\n\n–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: ${correct} –∑ ${lesson.quiz.length}\n–ù–∞–±—Ä–∞–Ω–æ –±–∞–ª—ñ–≤: ${score} –∑ ${lesson.points}\n\n–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–∞–ª—ñ–≤: ${totalScore}\n\n–ó–∞—Ä–∞–∑ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –≤–∞—à —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç!`);
            showCertificate();
        } else {
            alert(`üéâ –í—ñ—Ç–∞—î–º–æ!\n\n–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: ${correct} –∑ ${lesson.quiz.length}\n–ù–∞–±—Ä–∞–Ω–æ –±–∞–ª—ñ–≤: ${score} –∑ ${lesson.points}\n\n–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞—Å—Ç—É–ø–Ω–∏–π —É—Ä–æ–∫ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ.`);
            sendLessonCompletionEmail(lessonId);
            showScreen('dashboard');
        }
    } else {
        alert(`–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: ${correct} –∑ ${lesson.quiz.length}\n–ü–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º ${minCorrect} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —É—Ä–æ–∫—É.\n–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑!`);
    }
};

function showCertificate() {
    if (!currentUser) return;
    
    document.getElementById('modal-certificate-name').classList.remove('hidden');
}

function generateCertificate() {
    const fullName = document.getElementById('cert-full-name').value.trim();
    
    if (!fullName || fullName.split(' ').length < 2) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º\'—è');
        return;
    }
    
    let totalHours = 0;
    lessons.forEach(lesson => {
        const duration = lesson.duration || '00:00';
        const [minutes, seconds] = duration.split(':').map(Number);
        totalHours += (minutes || 0) + (seconds || 0) / 60;
    });
    
    const hours = Math.round(totalHours / 60 * 10) / 10;
    const certId = generateCertificateId();
    
    document.getElementById('cert-name').textContent = fullName;
    document.getElementById('cert-score').textContent = totalScore;
    document.getElementById('cert-hours').textContent = hours;
    document.getElementById('cert-date').textContent = new Date().toLocaleDateString('uk-UA', { year: 'numeric', month: 'long', day: 'numeric' });
    document.getElementById('cert-id').textContent = certId;
    
    if (currentUser) {
        currentUser.certificateId = certId;
        currentUser.certificateName = fullName;
        localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
    }
    
    generateQRCode(certId, fullName);
    
    document.getElementById('modal-certificate-name').classList.add('hidden');
    showScreen('certificate');
}

function generateCertificateId() {
    return 'CERT-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substring(2, 7).toUpperCase();
}

function generateQRCode(certId, fullName) {
    const canvas = document.getElementById('cert-qrcode');
    const verificationUrl = window.location.origin + window.location.pathname + '?verify=' + certId;
    const qrData = JSON.stringify({
        id: certId,
        name: fullName,
        course: '–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏',
        date: new Date().toISOString(),
        score: totalScore
    });
    
    QRCode.toCanvas(canvas, qrData, {
        width: 96,
        margin: 1,
        color: {
            dark: '#667eea',
            light: '#ffffff'
        }
    });
}

async function downloadCertificatePNG() {
    const certificate = document.getElementById('certificate');
    
    try {
        const canvas = await html2canvas(certificate, {
            scale: 2,
            backgroundColor: null,
            logging: false,
            useCORS: true
        });
        
        const link = document.createElement('a');
        link.download = '–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç_' + document.getElementById('cert-id').textContent + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
    }
}

async function downloadCertificatePDF() {
    const certificate = document.getElementById('certificate');
    
    try {
        const canvas = await html2canvas(certificate, {
            scale: 2,
            backgroundColor: null,
            logging: false,
            useCORS: true
        });
        
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            orientation: 'landscape',
            unit: 'mm',
            format: 'a4'
        });
        
        const imgWidth = 297;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        pdf.save('–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç_' + document.getElementById('cert-id').textContent + '.pdf');
    } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
    }
}

function adminLogin() {
    const code = document.getElementById('admin-code-input').value.trim();
    
    if (code === ADMIN_CODE) {
        isAdmin = true;
        loadAdminPanel();
        showScreen('admin');
    } else {
        alert('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –∞–¥–º—ñ–Ω-–∫–æ–¥!');
    }
}

function adminLogout() {
    if (confirm('–í–∏–π—Ç–∏ –∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ?')) {
        isAdmin = false;
        showScreen('login');
    }
}

function loadAdminPanel() {
    const users = [];
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('user_')) {
            try {
                const userData = JSON.parse(localStorage.getItem(key));
                users.push(userData);
            } catch (e) {}
        }
    }
    
    const totalUsers = users.length;
    const completedUsers = users.filter(u => u.completed && u.completed.length === 16).length;
    const activeUsers = users.filter(u => u.completed && u.completed.length > 0 && u.completed.length < 16).length;
    
    document.getElementById('admin-total-users').textContent = totalUsers;
    document.getElementById('admin-completed').textContent = completedUsers;
    document.getElementById('admin-active').textContent = activeUsers;
    
    renderUsersTable(users);
    refreshVideoErrorLogs();
}

function renderUsersTable(users) {
    const tbody = document.getElementById('admin-users-table');
    
    if (users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center py-8 text-gray-500">–ù–µ–º–∞—î –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</td></tr>';
        return;
    }
    
    users.sort((a, b) => new Date(b.registeredAt) - new Date(a.registeredAt));
    
    tbody.innerHTML = users.map(user => {
        const progress = user.completed ? user.completed.length : 0;
        const progressPercent = Math.round((progress / 16) * 100);
        const score = user.score || 0;
        const date = new Date(user.registeredAt).toLocaleDateString('uk-UA');
        
        const messages = getMessages(user.email);
        const unreadCount = messages.filter(m => m.sender === 'user' && !m.read).length;
        const unreadBadge = unreadCount > 0 ? `<span class="inline-block ml-1 px-1.5 py-0.5 bg-red-500 text-white text-xs rounded-full">${unreadCount}</span>` : '';
        
        const lastMessage = messages.length > 0 ? messages[messages.length - 1] : null;
        const lastMessageTime = lastMessage ? new Date(lastMessage.timestamp).toLocaleString('uk-UA', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' }) : '';
        const lastMessagePreview = lastMessage ? `<div class="text-xs text-gray-500 mt-1">${lastMessage.sender === 'user' ? 'üë§' : 'üëë'} ${lastMessageTime}</div>` : '';
        
        return `
            <tr class="border-b hover:bg-gray-50">
                <td class="py-3 px-4">${user.name}</td>
                <td class="py-3 px-4 text-sm">${user.email}</td>
                <td class="py-3 px-4 text-center">
                    <div class="flex items-center justify-center gap-2">
                        <div class="text-sm font-bold">${progress}/16</div>
                        <div class="text-xs text-gray-500">(${progressPercent}%)</div>
                    </div>
                </td>
                <td class="py-3 px-4 text-center font-bold text-purple-600">${score}</td>
                <td class="py-3 px-4 text-center text-sm text-gray-600">${date}</td>
                <td class="py-3 px-4 text-center">
                    <div class="flex items-center justify-center gap-2">
                        <button onclick="openAdminChat('${user.email}')" class="text-blue-600 hover:text-blue-800 text-sm font-semibold relative" title="–ù–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">üí¨${unreadBadge}</button>
                        <button onclick="deleteUser('${user.email}')" class="text-red-600 hover:text-red-800 text-sm font-semibold" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
                    </div>
                    ${lastMessagePreview}
                </td>
            </tr>
        `;
    }).join('');
}

function filterUsers() {
    const search = document.getElementById('admin-search').value.toLowerCase();
    const users = [];
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('user_')) {
            try {
                const userData = JSON.parse(localStorage.getItem(key));
                users.push(userData);
            } catch (e) {}
        }
    }
    
    const filtered = users.filter(user => 
        user.name.toLowerCase().includes(search) ||
        user.callsign.toLowerCase().includes(search) ||
        user.code.toLowerCase().includes(search) ||
        user.email.toLowerCase().includes(search)
    );
    
    renderUsersTable(filtered);
}

function deleteUser(email) {
    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?')) {
        localStorage.removeItem('user_' + email);
        loadAdminPanel();
        alert('‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª–µ–Ω–æ!');
    }
}

function showLegalDoc(type) {
    const titles = {
        privacy: '–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ',
        disclaimer: '–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ',
        terms: '–î–æ–≥–æ–≤—ñ—Ä –ø—É–±–ª—ñ—á–Ω–æ—ó –æ—Ñ–µ—Ä—Ç–∏'
    };
    
    const contents = {
        privacy: `
            <h3 class="text-xl font-bold mb-4">1. –ó–∞–≥–∞–ª—å–Ω—ñ –ø–æ–ª–æ–∂–µ–Ω–Ω—è</h3>
            <p class="mb-4">–¶—è –ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ –≤–∏–∑–Ω–∞—á–∞—î –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–æ–±–∫–∏ —Ç–∞ –∑–∞—Ö–∏—Å—Ç—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏: –Ω–µ–≤–∏–¥–∏–º—ñ –Ω–∏—Ç–∫–∏".</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">2. –Ø–∫—ñ –¥–∞–Ω—ñ –º–∏ –∑–±–∏—Ä–∞—î–º–æ</h3>
            <p class="mb-2">–ü—ñ–¥ —á–∞—Å —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –º–∏ –∑–±–∏—Ä–∞—î–º–æ:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</li>
                <li>Email –∞–¥—Ä–µ—Å—É</li>
                <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–æ–∑–∏–≤–Ω–∏–π</li>
                <li>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∫—É—Ä—Å—É</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">3. –Ø–∫ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–∞–Ω—ñ</h3>
            <p class="mb-2">–í–∞—à—ñ –¥–∞–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –¥–ª—è:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–ù–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫—É—Ä—Å—É</li>
                <li>–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—É</li>
                <li>–í—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–¥—É –¥–æ—Å—Ç—É–ø—É –Ω–∞ email</li>
                <li>–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ –∫—É—Ä—Å—É</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">4. –ó–∞—Ö–∏—Å—Ç –¥–∞–Ω–∏—Ö</h3>
            <p class="mb-4">–í—Å—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ (LocalStorage). –ú–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—î–º–æ –≤–∞—à—ñ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ —Ç—Ä–µ—Ç—ñ–º –æ—Å–æ–±–∞–º –±–µ–∑ –≤–∞—à–æ—ó –∑–≥–æ–¥–∏.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">5. –í–∞—à—ñ –ø—Ä–∞–≤–∞</h3>
            <p class="mb-2">–í–∏ –º–∞—î—Ç–µ –ø—Ä–∞–≤–æ:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–ü–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å–≤–æ—ó –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ</li>
                <li>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</li>
                <li>–í–∏–¥–∞–ª–∏—Ç–∏ —Å–≤—ñ–π –∞–∫–∞—É–Ω—Ç —É –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">6. –ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
            <p class="mb-4">–ó –ø–∏—Ç–∞–Ω—å –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è: <a href="mailto:psiholikar@gmail.com" class="text-blue-600 hover:underline">psiholikar@gmail.com</a></p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">7. –†–µ–∫–≤—ñ–∑–∏—Ç–∏</h3>
            <p class="mb-2"><strong>–§–û–ü –ö–∞–∑–∞—Ä'—è–Ω –ü–∞–≤–ª–æ –ê—à–æ—Ç–æ–≤–∏—á</strong></p>
            <p class="mb-2">–Ü–ü–ù: 2847814635</p>
            <p class="mb-2">IBAN: UA613052990000026006001711340</p>
            <p class="mb-2">–ê–¥—Ä–µ—Å–∞: –£–∫—Ä–∞—ó–Ω–∞, 57508, –ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª., –º—ñ—Å—Ç–æ –û—á–∞–∫—ñ–≤, –≤—É–ª –ü–æ—Ç—å–æ–º–∫—ñ–Ω–∞, –±—É–¥–∏–Ω–æ–∫ 4, –∫–≤–∞—Ä—Ç–∏—Ä–∞ 74</p>
            <p class="mb-4">Email: <a href="mailto:psiholikar@gmail.com" class="text-blue-600 hover:underline">psiholikar@gmail.com</a></p>
        `,
        disclaimer: `
            <h3 class="text-xl font-bold mb-4">1. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫—É—Ä—Å—É</h3>
            <p class="mb-4">–ö—É—Ä—Å "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏: –Ω–µ–≤–∏–¥–∏–º—ñ –Ω–∏—Ç–∫–∏" –º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ-–æ—Å–≤—ñ—Ç–Ω—ñ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä —ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Å–∞–º–æ–ø—ñ–∑–Ω–∞–Ω–Ω—è —Ç–∞ –æ—Å–æ–±–∏—Å—Ç—ñ—Å–Ω–æ–≥–æ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">2. –û–±–º–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ</h3>
            <p class="mb-4">–¶–µ–π –∫—É—Ä—Å –ù–ï —î:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–ú–µ–¥–∏—á–Ω–æ—é –ø–æ—Å–ª—É–≥–æ—é —á–∏ –ª—ñ–∫—É–≤–∞–Ω–Ω—è–º</li>
                <li>–ü—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø—ñ—î—é —á–∏ –∫–æ–Ω—Å—É–ª—å—Ç—É–≤–∞–Ω–Ω—è–º</li>
                <li>–ó–∞–º—ñ–Ω–æ—é –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ—ó –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏</li>
                <li>–ì–∞—Ä–∞–Ω—Ç—ñ—î—é –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –≤—Å—ñ—Ö –æ—Å–æ–±–∏—Å—Ç–∏—Ö –ø—Ä–æ–±–ª–µ–º</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h3>
            <p class="mb-4">–Ø–∫—â–æ –≤–∏ –≤—ñ–¥—á—É–≤–∞—î—Ç–µ —Å–µ—Ä–π–æ–∑–Ω—ñ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ —Ç—Ä—É–¥–Ω–æ—â—ñ, –¥–µ–ø—Ä–µ—Å—ñ—é, —Ç—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å –∞–±–æ —Å—É—ó—Ü–∏–¥–∞–ª—å–Ω—ñ –¥—É–º–∫–∏, –±—É–¥—å –ª–∞—Å–∫–∞, –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∞, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∞ –∞–±–æ –ø—Å–∏—Ö—ñ–∞—Ç—Ä–∞.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">4. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏</h3>
            <p class="mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∫—É—Ä—Å—É —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ —ñ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –±–∞–≥–∞—Ç—å–æ—Ö —Ñ–∞–∫—Ç–æ—Ä—ñ–≤. –ú–∏ –Ω–µ –≥–∞—Ä–∞–Ω—Ç—É—î–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∞–±–æ –∑–º—ñ–Ω —É –≤–∞—à–æ–º—É –∂–∏—Ç—Ç—ñ.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">5. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h3>
            <p class="mb-4">–í–∏ –Ω–µ—Å–µ—Ç–µ –ø–æ–≤–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –∫—É—Ä—Å—É —Ç–∞ —ó—ó –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —É —Å–≤–æ—î–º—É –∂–∏—Ç—Ç—ñ. –ü—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∫—É—Ä—Å—É –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –Ω–∞ –≤–∞—à –≤–ª–∞—Å–Ω–∏–π —Ä–æ–∑—Å—É–¥ —ñ —Ä–∏–∑–∏–∫.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">6. –ê–≤—Ç–æ—Ä—Å—å–∫—ñ –ø—Ä–∞–≤–∞</h3>
            <p class="mb-4">–í—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É –∑–∞—Ö–∏—â–µ–Ω—ñ –∞–≤—Ç–æ—Ä—Å—å–∫–∏–º –ø—Ä–∞–≤–æ–º. –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è, —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è –∞–±–æ –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–µ–∑ –ø–∏—Å—å–º–æ–≤–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">7. –ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
            <p class="mb-4">–§–û–ü –ö–∞–∑–∞—Ä'—è–Ω –ü–∞–≤–ª–æ –ê—à–æ—Ç–æ–≤–∏—á<br>
Email: <a href="mailto:psiholikar@gmail.com" class="text-blue-600 hover:underline">psiholikar@gmail.com</a></p>
        `,
        terms: `
            <h3 class="text-xl font-bold mb-4">1. –ü—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä—É</h3>
            <p class="mb-4">–¶–µ–π –¥–æ–≥–æ–≤—ñ—Ä –ø—É–±–ª—ñ—á–Ω–æ—ó –æ—Ñ–µ—Ä—Ç–∏ —Ä–µ–≥—É–ª—é—î –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ –º—ñ–∂ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—î—é –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏: –Ω–µ–≤–∏–¥–∏–º—ñ –Ω–∏—Ç–∫–∏" (–Ω–∞–¥–∞–ª—ñ - –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å) —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º (–Ω–∞–¥–∞–ª—ñ - –ó–∞–º–æ–≤–Ω–∏–∫).</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">2. –ü—Ä–µ–¥–º–µ—Ç –ø–æ—Å–ª—É–≥</h3>
            <p class="mb-4">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –Ω–∞–¥–∞—î –ó–∞–º–æ–≤–Ω–∏–∫—É –¥–æ—Å—Ç—É–ø –¥–æ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—É, —è–∫–∏–π –≤–∫–ª—é—á–∞—î:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>17 –≤—ñ–¥–µ–æ-—É—Ä–æ–∫—ñ–≤</li>
                <li>85 –ø–∏—Ç–∞–Ω—å –¥–ª—è —Å–∞–º–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</li>
                <li>–†–æ–±–æ—á–∏–π –∑–æ—à–∏—Ç –¥–ª—è –Ω–æ—Ç–∞—Ç–æ–∫</li>
                <li>–®–Ü-–ø–æ–º—ñ—á–Ω–∏–∫–∞ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏</li>
                <li>–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫—É—Ä—Å—É</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">3. –ü–æ—Ä—è–¥–æ–∫ –Ω–∞–¥–∞–Ω–Ω—è –ø–æ—Å–ª—É–≥</h3>
            <p class="mb-4">3.1. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –ó–∞–º–æ–≤–Ω–∏–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ.</p>
            <p class="mb-4">3.2. –ü—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –ó–∞–º–æ–≤–Ω–∏–∫ –æ—Ç—Ä–∏–º—É—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø—É –Ω–∞ email.</p>
            <p class="mb-4">3.3. –î–æ—Å—Ç—É–ø –¥–æ –∫—É—Ä—Å—É –Ω–∞–¥–∞—î—Ç—å—Å—è –Ω–∞ –Ω–µ–æ–±–º–µ–∂–µ–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">4. –ü—Ä–∞–≤–∞ —Ç–∞ –æ–±–æ–≤'—è–∑–∫–∏ –ó–∞–º–æ–≤–Ω–∏–∫–∞</h3>
            <p class="mb-4">4.1. –ó–∞–º–æ–≤–Ω–∏–∫ –º–∞—î –ø—Ä–∞–≤–æ:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–ü—Ä–æ—Ö–æ–¥–∏—Ç–∏ –∫—É—Ä—Å —É –∑—Ä—É—á–Ω–æ–º—É —Ç–µ–º–ø—ñ</li>
                <li>–ü–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–µ–æ–±–º–µ–∂–µ–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–∞–∑—ñ–≤</li>
                <li>–í–∏–¥–∞–ª–∏—Ç–∏ —Å–≤—ñ–π –∞–∫–∞—É–Ω—Ç —É –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç</li>
            </ul>
            <p class="mb-4">4.2. –ó–∞–º–æ–≤–Ω–∏–∫ –∑–æ–±–æ–≤'—è–∑—É—î—Ç—å—Å—è:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–ù–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç–æ–≤—ñ—Ä–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</li>
                <li>–ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —Å–≤—ñ–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø—É —Ç—Ä–µ—Ç—ñ–º –æ—Å–æ–±–∞–º</li>
                <li>–ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É –≤ –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–∏—Ö —Ü—ñ–ª—è—Ö</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">5. –ü—Ä–∞–≤–∞ —Ç–∞ –æ–±–æ–≤'—è–∑–∫–∏ –í–∏–∫–æ–Ω–∞–≤—Ü—è</h3>
            <p class="mb-4">5.1. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –∑–æ–±–æ–≤'—è–∑—É—î—Ç—å—Å—è:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫—É—Ä—Å—É –ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</li>
                <li>–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏</li>
                <li>–ó–∞—Ö–∏—â–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</li>
            </ul>
            <p class="mb-4">5.2. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –º–∞—î –ø—Ä–∞–≤–æ:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –∫—É—Ä—Å—É</li>
                <li>–ü—Ä–∏–∑—É–ø–∏–Ω–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É —Ä–∞–∑—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è —É–º–æ–≤</li>
                <li>–ó–º—ñ–Ω—é–≤–∞—Ç–∏ —É–º–æ–≤–∏ –¥–æ–≥–æ–≤–æ—Ä—É –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">6. –í–∞—Ä—Ç—ñ—Å—Ç—å –ø–æ—Å–ª—É–≥</h3>
            <p class="mb-4">–ù–∞ –º–æ–º–µ–Ω—Ç —É–∫–ª–∞–¥–µ–Ω–Ω—è –¥–æ–≥–æ–≤–æ—Ä—É –∫—É—Ä—Å –Ω–∞–¥–∞—î—Ç—å—Å—è –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –∑–∞–ª–∏—à–∞—î –∑–∞ —Å–æ–±–æ—é –ø—Ä–∞–≤–æ –∑–º—ñ–Ω–∏—Ç–∏ —É–º–æ–≤–∏ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –≤–≤–µ—Å—Ç–∏ –ø–ª–∞—Ç–Ω—ñ –æ–ø—Ü—ñ—ó.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">7. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω</h3>
            <p class="mb-4">7.1. –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å –Ω–µ –Ω–µ—Å–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞:</p>
            <ul class="list-disc pl-6 mb-4">
                <li>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–Ω–∞–Ω—å –∑ –∫—É—Ä—Å—É</li>
                <li>–¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–±–æ—ó –Ω–µ –∑ –≤–∏–Ω–∏ –í–∏–∫–æ–Ω–∞–≤—Ü—è</li>
                <li>–í—Ç—Ä–∞—Ç—É –∫–æ–¥—É –¥–æ—Å—Ç—É–ø—É –∑ –≤–∏–Ω–∏ –ó–∞–º–æ–≤–Ω–∏–∫–∞</li>
            </ul>
            
            <h3 class="text-xl font-bold mb-4 mt-6">8. –§–æ—Ä—Å-–º–∞–∂–æ—Ä</h3>
            <p class="mb-4">–°—Ç–æ—Ä–æ–Ω–∏ –∑–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ –Ω–µ–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–æ–±–æ–≤'—è–∑–∞–Ω—å —É —Ä–∞–∑—ñ —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä–Ω–∏—Ö –æ–±—Å—Ç–∞–≤–∏–Ω.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">9. –ü—Ä–∏–π–Ω—è—Ç—Ç—è —É–º–æ–≤</h3>
            <p class="mb-4">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –æ–∑–Ω–∞—á–∞—î –ø–æ–≤–Ω—É —Ç–∞ –±–µ–∑–∑–∞—Å—Ç–µ—Ä–µ–∂–Ω—É –∑–≥–æ–¥—É –∑ —É–º–æ–≤–∞–º–∏ —Ü—å–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä—É.</p>
            
            <h3 class="text-xl font-bold mb-4 mt-6">10. –†–µ–∫–≤—ñ–∑–∏—Ç–∏ –í–∏–∫–æ–Ω–∞–≤—Ü—è</h3>
            <div class="bg-gray-50 p-4 rounded-lg">
                <p class="mb-2"><strong>–§–û–ü –ö–∞–∑–∞—Ä'—è–Ω –ü–∞–≤–ª–æ –ê—à–æ—Ç–æ–≤–∏—á</strong></p>
                <p class="mb-2">üèõÔ∏è –ê–¥—Ä–µ—Å–∞: –£–∫—Ä–∞—ó–Ω–∞, 57508, –ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª., –º—ñ—Å—Ç–æ –û—á–∞–∫—ñ–≤,<br>–≤—É–ª. –ü–æ—Ç—å–æ–º–∫—ñ–Ω–∞, –±—É–¥–∏–Ω–æ–∫ 4, –∫–≤–∞—Ä—Ç–∏—Ä–∞ 74 (–ª–∏—Å—Ç—É–≤–∞–Ω–Ω—è)</p>
                <p class="mb-2">üÜî –Ü–ü–ù: 2847814635</p>
                <p class="mb-2">üí≥ IBAN: UA613052990000026006001711340</p>
                <p class="mb-2">üìß Email: <a href="mailto:psiholikar@gmail.com" class="text-blue-600 hover:underline">psiholikar@gmail.com</a></p>
            </div>
        `
    };
    
    document.getElementById('legal-title').textContent = titles[type];
    document.getElementById('legal-content').innerHTML = contents[type];
    document.getElementById('modal-legal').classList.remove('hidden');
}

function closeLegalDoc() {
    document.getElementById('modal-legal').classList.add('hidden');
}

function exportUsers() {
    const users = [];
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('user_')) {
            try {
                const userData = JSON.parse(localStorage.getItem(key));
                users.push(userData);
            } catch (e) {}
        }
    }
    
    if (users.length === 0) {
        alert('–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É');
        return;
    }
    
    let csv = '–Ü–º\'—è,Email,–ü—Ä–æ–≥—Ä–µ—Å,–ë–∞–ª–∏,–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó\n';
    
    users.forEach(user => {
        const progress = user.completed ? user.completed.length : 0;
        const score = user.score || 0;
        const date = new Date(user.registeredAt).toLocaleDateString('uk-UA');
        
        csv += `"${user.name}","${user.email}",${progress}/16,${score},"${date}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', 'users_' + new Date().toISOString().split('T')[0] + '.csv');
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

let adminAiMessages = [];

function toggleAdminAI() {
    const ai = document.getElementById('admin-ai-assistant');
    ai.classList.toggle('hidden');
    
    if (!ai.classList.contains('hidden') && adminAiMessages.length === 0) {
        addAdminAIMessage('assistant', 'üëã –í—ñ—Ç–∞—é! –Ø –≤–∞—à –®–Ü –∞–Ω–∞–ª—ñ—Ç–∏–∫.\n\n–Ø –º–æ–∂—É:\n‚Ä¢ üìä –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å —É—Å—ñ—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤\n‚Ä¢ üìù –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ä–æ–±–æ—á–∏—Ö –∑–æ—à–∏—Ç–∞—Ö\n‚Ä¢ ‚ö†Ô∏è –í–∏—è–≤–ª—è—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —É–≤–∞–≥–∏\n‚Ä¢ üèÜ –ó–Ω–∞—Ö–æ–¥–∏—Ç–∏ –∫—Ä–∞—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤\n‚Ä¢ üí° –î–∞–≤–∞—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –ø–æ–ª—ñ–ø—à–µ–Ω–Ω—è –∫—É—Ä—Å—É\n\n–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∞–±–æ –∑–∞–¥–∞–π—Ç–µ —Å–≤–æ—î –ø–∏—Ç–∞–Ω–Ω—è!');
    }
}

function addAdminAIMessage(role, content) {
    const chatDiv = document.getElementById('admin-ai-chat');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${role}`;
    messageDiv.textContent = content;
    chatDiv.appendChild(messageDiv);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function getAllUsersData() {
    const users = [];
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('user_')) {
            try {
                const userData = JSON.parse(localStorage.getItem(key));
                users.push(userData);
            } catch (e) {}
        }
    }
    
    return users;
}

async function sendAdminAIMessage() {
    const input = document.getElementById('admin-ai-input');
    const message = input.value.trim();
    
    if (!message) return;
    
    input.value = '';
    addAdminAIMessage('user', message);
    adminAiMessages.push({ role: 'user', content: message });
    
    const users = getAllUsersData();
    const usersContext = users.map(u => ({
        name: u.name,
        callsign: u.callsign,
        progress: u.completed ? u.completed.length : 0,
        score: u.score || 0,
        workbook: u.workbook || '',
        registeredAt: u.registeredAt
    }));
    
    const thinkingDiv = document.createElement('div');
    thinkingDiv.className = 'message assistant';
    thinkingDiv.innerHTML = 'ü§î –ê–Ω–∞–ª—ñ–∑—É—é –¥–∞–Ω—ñ...';
    thinkingDiv.id = 'admin-thinking';
    document.getElementById('admin-ai-chat').appendChild(thinkingDiv);
    
    try {
        const response = await fetch('https://inviz-threads.phil-1879nlp.workers.dev/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: 'gpt-4',
                messages: [
                    { 
                        role: 'system', 
                        content: `–¢–∏ –®–Ü –∞–Ω–∞–ª—ñ—Ç–∏–∫ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∫—É—Ä—Å—É "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏". –ê–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –¥–∞–≤–∞–π –∫–æ—Ä–∏—Å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.\n\n–ö—É—Ä—Å —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ 17 —É—Ä–æ–∫—ñ–≤, –º–∞–∫—Å–∏–º—É–º 425 –±–∞–ª—ñ–≤.\n\n–î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ${JSON.stringify(usersContext)}\n\n–í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é, –±—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º, –¥–∞–≤–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.` 
                    },
                    ...adminAiMessages
                ],
                max_tokens: 800,
                temperature: 0.7
            })
        });
        
        document.getElementById('admin-thinking')?.remove();
        
        if (response.ok) {
            const data = await response.json();
            const reply = data.choices[0].message.content;
            adminAiMessages.push({ role: 'assistant', content: reply });
            addAdminAIMessage('assistant', reply);
        } else {
            addAdminAIMessage('assistant', '‚ùå –í–∏–±–∞—á—Ç–µ, –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
        }
    } catch (error) {
        document.getElementById('admin-thinking')?.remove();
        addAdminAIMessage('assistant', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–≤\'\u044f–∑–∫—É –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.');
    }
}

async function analyzeAllUsers() {
    const users = getAllUsersData();
    
    if (users.length === 0) {
        addAdminAIMessage('assistant', '‚ö†Ô∏è –ù–µ–º–∞—î –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É.');
        return;
    }
    
    addAdminAIMessage('user', 'üìä –ê–Ω–∞–ª—ñ–∑ —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤');
    
    const message = `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –∑–∞–≥–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É—Å—ñ—Ö ${users.length} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –î–∞–π –∑–∞–≥–∞–ª—å–Ω–∏–π –æ–≥–ª—è–¥: —Å–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä–æ–≥—Ä–µ—Å, —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª, —Å–∫—ñ–ª—å–∫–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏, —Å–∫—ñ–ª—å–∫–∏ –≤ –ø—Ä–æ—Ü–µ—Å—ñ, —Å–∫—ñ–ª—å–∫–∏ —Ç—ñ–ª—å–∫–∏ –ø–æ—á–∞–ª–∏. –î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–ª—ñ–ø—à–µ–Ω–Ω—è –∑–∞–ª—É—á–µ–Ω–æ—Å—Ç—ñ.`;
    
    adminAiMessages.push({ role: 'user', content: message });
    
    await sendAdminAIAnalysis(message, users);
}

async function analyzeLowPerformers() {
    const users = getAllUsersData();
    const lowPerformers = users.filter(u => {
        const progress = u.completed ? u.completed.length : 0;
        return progress < 5 && progress > 0;
    });
    
    if (lowPerformers.length === 0) {
        addAdminAIMessage('assistant', '‚úÖ –í—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏ –¥–æ–±—Ä–µ –ø—Ä–æ–≥—Ä–µ—Å—É—é—Ç—å! –ù–µ–º–∞—î —Ç–∏—Ö, —Ö—Ç–æ –≤—ñ–¥—Å—Ç–∞—î.');
        return;
    }
    
    addAdminAIMessage('user', '‚ö†Ô∏è –ê–Ω–∞–ª—ñ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑—ñ —Å–ª–∞–±–∫–∏–º –ø—Ä–æ–≥—Ä–µ—Å–æ–º');
    
    const message = `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π ${lowPerformers.length} —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å —Å–ª–∞–±–∫–∏–π –ø—Ä–æ–≥—Ä–µ—Å (–º–µ–Ω—à–µ 5 —É—Ä–æ–∫—ñ–≤). –ß–æ–º—É –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –≤—ñ–¥—Å—Ç–∞–≤–∞—Ç–∏? –Ø–∫ —ó—Ö –º–æ—Ç–∏–≤—É–≤–∞—Ç–∏ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?`;
    
    adminAiMessages.push({ role: 'user', content: message });
    
    await sendAdminAIAnalysis(message, lowPerformers);
}

async function analyzeTopPerformers() {
    const users = getAllUsersData();
    const topPerformers = users.filter(u => {
        const progress = u.completed ? u.completed.length : 0;
        return progress >= 15;
    });
    
    if (topPerformers.length === 0) {
        addAdminAIMessage('assistant', 'üìä –ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –º–∞–π–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å.');
        return;
    }
    
    addAdminAIMessage('user', 'üèÜ –ê–Ω–∞–ª—ñ–∑ –∫—Ä–∞—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤');
    
    const message = `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π ${topPerformers.length} –∫—Ä–∞—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ (–ø—Ä–æ–π—à–ª–∏ 15+ —É—Ä–æ–∫—ñ–≤). –©–æ –≤–æ–Ω–∏ —Ä–æ–±–ª—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ? –Ø–∫—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü—ñ—ó —ñ–Ω—à–∏—Ö?`;
    
    adminAiMessages.push({ role: 'user', content: message });
    
    await sendAdminAIAnalysis(message, topPerformers);
}

async function sendAdminAIAnalysis(message, users) {
    const usersContext = users.map(u => ({
        name: u.name,
        callsign: u.callsign,
        progress: u.completed ? u.completed.length : 0,
        score: u.score || 0,
        workbook: u.workbook ? u.workbook.substring(0, 500) : '',
        registeredAt: u.registeredAt
    }));
    
    const thinkingDiv = document.createElement('div');
    thinkingDiv.className = 'message assistant';
    thinkingDiv.innerHTML = 'ü§î –ê–Ω–∞–ª—ñ–∑—É—é –¥–∞–Ω—ñ...';
    thinkingDiv.id = 'admin-thinking';
    document.getElementById('admin-ai-chat').appendChild(thinkingDiv);
    
    try {
        const response = await fetch('https://inviz-threads.phil-1879nlp.workers.dev/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: 'gpt-4',
                messages: [
                    { 
                        role: 'system', 
                        content: `–¢–∏ –®–Ü –∞–Ω–∞–ª—ñ—Ç–∏–∫ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∫—É—Ä—Å—É "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏". –ê–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –¥–∞–≤–∞–π –∫–æ—Ä–∏—Å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.\n\n–ö—É—Ä—Å —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ 17 —É—Ä–æ–∫—ñ–≤, –º–∞–∫—Å–∏–º—É–º 425 –±–∞–ª—ñ–≤.\n\n–î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ${JSON.stringify(usersContext)}\n\n–í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é, –±—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º, –¥–∞–≤–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.` 
                    },
                    { role: 'user', content: message }
                ],
                max_tokens: 800,
                temperature: 0.7
            })
        });
        
        document.getElementById('admin-thinking')?.remove();
        
        if (response.ok) {
            const data = await response.json();
            const reply = data.choices[0].message.content;
            adminAiMessages.push({ role: 'assistant', content: reply });
            addAdminAIMessage('assistant', reply);
        } else {
            addAdminAIMessage('assistant', '‚ùå –í–∏–±–∞—á—Ç–µ, –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
        }
    } catch (error) {
        document.getElementById('admin-thinking')?.remove();
        addAdminAIMessage('assistant', '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–≤\'\u044f–∑–∫—É –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.');
    }
}

let currentChatUserEmail = null;

function getMessagesKey(userEmail) {
    return 'messages_' + userEmail;
}

function getMessages(userEmail) {
    const data = localStorage.getItem(getMessagesKey(userEmail));
    return data ? JSON.parse(data) : [];
}

function saveMessages(userEmail, messages) {
    localStorage.setItem(getMessagesKey(userEmail), JSON.stringify(messages));
}

function addMessageToChat(chatElementId, sender, text, timestamp) {
    const chatDiv = document.getElementById(chatElementId);
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender === 'admin' ? 'assistant' : 'user'}`;
    
    const time = new Date(timestamp).toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
    const senderLabel = sender === 'admin' ? 'üëë –ê–¥–º—ñ–Ω' : 'üë§ –í–∏';
    
    messageDiv.innerHTML = `<div class="text-xs text-gray-500 mb-1">${senderLabel} ‚Ä¢ ${time}</div><div>${text}</div>`;
    chatDiv.appendChild(messageDiv);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function openAdminChat(userEmail) {
    currentChatUserEmail = userEmail;
    const userData = localStorage.getItem('user_' + userEmail);
    
    if (!userData) {
        alert('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π');
        return;
    }
    
    const user = JSON.parse(userData);
    document.getElementById('admin-chat-user-name').textContent = `${user.name} (${user.email})`;
    
    const chatDiv = document.getElementById('admin-chat-messages');
    chatDiv.innerHTML = '';
    
    const messages = getMessages(userEmail);
    if (messages.length === 0) {
        addMessageToChat('admin-chat-messages', 'system', 'üëã –ü–æ—á–Ω—ñ—Ç—å —Ä–æ–∑–º–æ–≤—É –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º...', Date.now());
    } else {
        messages.forEach(msg => {
            addMessageToChat('admin-chat-messages', msg.sender, msg.text, msg.timestamp);
            if (msg.sender === 'user' && !msg.read) {
                msg.read = true;
            }
        });
        saveMessages(userEmail, messages);
        loadAdminPanel();
    }
    
    document.getElementById('admin-chat-modal').classList.remove('hidden');
    document.getElementById('admin-chat-input').focus();
}

function closeAdminChat() {
    document.getElementById('admin-chat-modal').classList.add('hidden');
    currentChatUserEmail = null;
}

function sendAdminMessage() {
    const input = document.getElementById('admin-chat-input');
    const text = input.value.trim();
    
    if (!text || !currentChatUserEmail) return;
    
    const message = {
        sender: 'admin',
        text: text,
        timestamp: Date.now(),
        read: false
    };
    
    const messages = getMessages(currentChatUserEmail);
    messages.push(message);
    saveMessages(currentChatUserEmail, messages);
    
    addMessageToChat('admin-chat-messages', 'admin', text, message.timestamp);
    input.value = '';
}

function toggleUserMessages() {
    const modal = document.getElementById('user-messages');
    const isHidden = modal.classList.contains('hidden');
    
    modal.classList.toggle('hidden');
    
    if (isHidden) {
        loadUserMessages();
    }
}

function loadUserMessages() {
    if (!currentUser) return;
    
    const chatDiv = document.getElementById('user-messages-chat');
    chatDiv.innerHTML = '';
    
    const messages = getMessages(currentUser.email);
    
    if (messages.length === 0) {
        addMessageToChat('user-messages-chat', 'system', 'üëã –í—ñ—Ç–∞—î–º–æ! –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫—É—Ä—Å—É.\n\n–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤–æ—î –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –∫–æ–º–µ–Ω—Ç–∞—Ä!', Date.now());
    } else {
        messages.forEach(msg => {
            addMessageToChat('user-messages-chat', msg.sender, msg.text, msg.timestamp);
            if (!msg.read && msg.sender === 'admin') {
                msg.read = true;
            }
        });
        saveMessages(currentUser.email, messages);
        updateUnreadBadge();
    }
    
    document.getElementById('user-message-input').focus();
}

function sendUserMessage() {
    if (!currentUser) return;
    
    const input = document.getElementById('user-message-input');
    const text = input.value.trim();
    
    if (!text) return;
    
    const message = {
        sender: 'user',
        text: text,
        timestamp: Date.now(),
        read: false
    };
    
    const messages = getMessages(currentUser.email);
    messages.push(message);
    saveMessages(currentUser.email, messages);
    
    addMessageToChat('user-messages-chat', 'user', text, message.timestamp);
    input.value = '';
}

function updateUnreadBadge() {
    if (!currentUser) return;
    
    const messages = getMessages(currentUser.email);
    const unreadCount = messages.filter(m => m.sender === 'admin' && !m.read).length;
    
    const badge = document.getElementById('unread-badge');
    if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
    }
}

setInterval(() => {
    if (currentUser && currentScreen === 'dashboard') {
        updateUnreadBadge();
    }
    
    if (currentScreen === 'admin') {
        const currentTable = document.getElementById('admin-users-table');
        if (currentTable && currentTable.children.length > 0) {
            loadAdminPanel();
        }
    }
}, 5000);

window.showScreen = showScreen;

function refreshVideoErrorLogs() {
    const errorLogs = JSON.parse(localStorage.getItem('video_error_logs') || '[]');
    
    const totalErrors = errorLogs.length;
    const loadErrors = errorLogs.filter(e => e.errorType === 'load_error').length;
    const slowLoads = errorLogs.filter(e => e.errorType === 'slow_load').length;
    const userReported = errorLogs.filter(e => e.errorType === 'user_reported').length;
    
    const statsContainer = document.getElementById('video-error-stats');
    statsContainer.innerHTML = `
        <div class="bg-red-50 p-4 rounded-lg border-2 border-red-200">
            <div class="text-2xl font-black text-red-600">${totalErrors}</div>
            <div class="text-sm text-gray-700">–ó–∞–≥–∞–ª–æ–º –ø–æ–º–∏–ª–æ–∫</div>
        </div>
        <div class="bg-orange-50 p-4 rounded-lg border-2 border-orange-200">
            <div class="text-2xl font-black text-orange-600">${loadErrors}</div>
            <div class="text-sm text-gray-700">–ü–æ–º–∏–ª–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>
        </div>
        <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200">
            <div class="text-2xl font-black text-yellow-600">${slowLoads}</div>
            <div class="text-sm text-gray-700">–ü–æ–≤—ñ–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
            <div class="text-2xl font-black text-purple-600">${userReported}</div>
            <div class="text-sm text-gray-700">–°–∫–∞—Ä–≥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>
        </div>
    `;
    
    const tbody = document.getElementById('video-error-logs-table');
    
    if (errorLogs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">–ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫ –≤—ñ–¥–µ–æ üéâ</td></tr>';
        return;
    }
    
    const recentErrors = errorLogs.slice(-100).reverse();
    
    tbody.innerHTML = recentErrors.map(log => {
        const time = new Date(log.timestamp).toLocaleString('uk-UA', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });
        const errorTypeLabels = {
            'load_error': '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è',
            'slow_load': '‚ö†Ô∏è –ü–æ–≤—ñ–ª—å–Ω–æ',
            'user_reported': 'üì¢ –°–∫–∞—Ä–≥–∞'
        };
        const errorLabel = errorTypeLabels[log.errorType] || log.errorType;
        const issue = log.issue ? `<div class="text-xs text-gray-500 mt-1">""${log.issue}""</div>` : '';
        
        return `
            <tr class="border-b hover:bg-gray-50">
                <td class="py-2 px-3 text-xs text-gray-600">${time}</td>
                <td class="py-2 px-3">–£—Ä–æ–∫ ${log.lessonId} (–ß–∞—Å—Ç–∏–Ω–∞ ${log.partNum})</td>
                <td class="py-2 px-3 font-mono text-xs">${log.videoId}</td>
                <td class="py-2 px-3">${errorLabel}</td>
                <td class="py-2 px-3 text-sm">${log.userName}<br><span class="text-xs text-gray-500">${log.userEmail}</span></td>
                <td class="py-2 px-3 text-xs">${issue}</td>
            </tr>
        `;
    }).join('');
}

function clearVideoErrorLogs() {
    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—Å—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ª–æ–≥–∏ –ø–æ–º–∏–ª–æ–∫ –≤—ñ–¥–µ–æ?')) {
        localStorage.removeItem('video_error_logs');
        refreshVideoErrorLogs();
        alert('‚úÖ –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω–æ!');
    }
}

function exportVideoErrors() {
    const errorLogs = JSON.parse(localStorage.getItem('video_error_logs') || '[]');
    
    if (errorLogs.length === 0) {
        alert('–ù–µ–º–∞—î –ª–æ–≥—ñ–≤ –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É');
        return;
    }
    
    const csv = [
        ['Timestamp', 'Lesson ID', 'Video ID', 'Part', 'Error Type', 'User Name', 'User Email', 'Issue', 'User Agent'].join(','),
        ...errorLogs.map(log => [
            log.timestamp,
            log.lessonId,
            log.videoId,
            log.partNum,
            log.errorType,
            log.userName,
            log.userEmail,
            log.issue || '',
            log.userAgent
        ].map(v => `"${v}"`).join(','))
    ].join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `video-errors-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
}

window.refreshVideoErrorLogs = refreshVideoErrorLogs;
window.clearVideoErrorLogs = clearVideoErrorLogs;
window.exportVideoErrors = exportVideoErrors;

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        const swCode = `
const CACHE_NAME = 'parental-directives-v1';
const urlsToCache = [
  './',
  'https://cdn.tailwindcss.com',
  'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap',
  'https://res2.weblium.site/res/656e15d29a2eb3000f9a162d/656f023ff0279b000f7b941b_optimized_262.webp'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request)
      .then(response => response || fetch(event.request))
      .catch(() => {
        if (event.request.destination === 'document') {
          return caches.match('./');
        }
      })
  );
});

self.addEventListener('activate', event => {
  event.waitUntil(
    caches.keys().then(cacheNames => {
      return Promise.all(
        cacheNames.map(cacheName => {
          if (cacheName !== CACHE_NAME) {
            return caches.delete(cacheName);
          }
        })
      );
    })
  );
});
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
            .then(registration => {
                console.log('‚úÖ Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ:', registration.scope);
                checkForUpdates(registration);
            })
            .catch(err => console.log('‚ùå Service Worker –ø–æ–º–∏–ª–∫–∞:', err));
    });
}

function checkForUpdates(registration) {
    setInterval(() => {
        registration.update();
    }, 60000);
}

let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    showInstallPrompt();
});

function showInstallPrompt() {
    const installBanner = document.createElement('div');
    installBanner.id = 'pwa-install-banner';
    installBanner.className = 'fixed bottom-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-2xl z-50 fade-in';
    installBanner.innerHTML = `
        <div class="max-w-4xl mx-auto flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <span class="text-3xl">üì±</span>
                <div>
                    <div class="font-bold">–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫</div>
                    <div class="text-sm opacity-90">–û—Ç—Ä–∏–º–∞–π—Ç–µ —à–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø —Ç–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º</div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="installPWA()" class="bg-white text-blue-600 px-6 py-2 rounded-lg font-bold hover:bg-gray-100">
                    –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏
                </button>
                <button onclick="dismissInstallPrompt()" class="text-white hover:text-gray-200 px-3">
                    ‚úï
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(installBanner);
}

window.installPWA = async function() {
    if (!deferredPrompt) return;
    
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    
    if (outcome === 'accepted') {
        console.log('‚úÖ PWA –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    }
    
    deferredPrompt = null;
    dismissInstallPrompt();
};

window.dismissInstallPrompt = function() {
    const banner = document.getElementById('pwa-install-banner');
    if (banner) banner.remove();
};

function checkOnlineStatus() {
    const statusIndicator = document.createElement('div');
    statusIndicator.id = 'online-status';
    statusIndicator.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg text-sm font-semibold shadow-lg z-50';
    
    function updateStatus() {
        if (navigator.onLine) {
            statusIndicator.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg text-sm font-semibold shadow-lg z-50 bg-green-500 text-white fade-in';
            statusIndicator.innerHTML = '‚úÖ –û–Ω–ª–∞–π–Ω';
            setTimeout(() => statusIndicator.remove(), 3000);
        } else {
            statusIndicator.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg text-sm font-semibold shadow-lg z-50 bg-orange-500 text-white';
            statusIndicator.innerHTML = '‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º';
            document.body.appendChild(statusIndicator);
        }
    }
    
    window.addEventListener('online', updateStatus);
    window.addEventListener('offline', updateStatus);
    
    if (!navigator.onLine) updateStatus();
}

checkOnlineStatus();

window.toggleEmailSettings = function() {
    const modal = document.getElementById('email-settings-modal');
    modal.classList.toggle('hidden');
    if (!modal.classList.contains('hidden')) {
        loadEmailPreferences();
    }
};

function loadEmailPreferences() {
    if (!currentUser) return;
    
    const prefs = currentUser.emailPreferences || {
        newLessons: true,
        updates: true,
        reminders: false,
        weekly: false
    };
    
    document.getElementById('email-new-lessons').checked = prefs.newLessons;
    document.getElementById('email-updates').checked = prefs.updates;
    document.getElementById('email-reminders').checked = prefs.reminders;
    document.getElementById('email-weekly').checked = prefs.weekly;
}

function saveEmailPreferences() {
    if (!currentUser) return;
    
    currentUser.emailPreferences = {
        newLessons: document.getElementById('email-new-lessons').checked,
        updates: document.getElementById('email-updates').checked,
        reminders: document.getElementById('email-reminders').checked,
        weekly: document.getElementById('email-weekly').checked
    };
    
    localStorage.setItem('user_' + currentUser.email, JSON.stringify(currentUser));
    
    showEmailStatus('‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ!', 'success');
}

function showEmailStatus(message, type) {
    const statusEl = document.getElementById('email-status');
    statusEl.textContent = message;
    statusEl.className = `mb-4 p-3 rounded-lg text-sm ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
    statusEl.classList.remove('hidden');
    
    setTimeout(() => statusEl.classList.add('hidden'), 3000);
}

async function testEmailNotification() {
    if (!currentUser) return;
    
    const prefs = currentUser.emailPreferences || {};
    if (!prefs.newLessons && !prefs.updates && !prefs.reminders && !prefs.weekly) {
        showEmailStatus('‚ö†Ô∏è –£–≤—ñ–º–∫–Ω—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', 'error');
        return;
    }
    
    showEmailStatus('üìß –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è email...', 'success');
    
    try {
        const response = await fetch(`${window.HATCH_CONFIG?.apiBaseUrl || ''}/services/send_email`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: currentUser.name,
                email: currentUser.email,
                message: `–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è \n\n–í—ñ—Ç–∞—î–º–æ, ${currentUser.name}!\n\n–¶–µ —Ç–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫—É—Ä—Å—É "–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ –¥–∏—Ä–µ–∫—Ç–∏–≤–∏".\n\n–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å: ${completed.size}/16 —É—Ä–æ–∫—ñ–≤\n–ë–∞–ª–∏: ${totalScore}\n\n–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è email:\n- –ù–æ–≤—ñ —É—Ä–æ–∫–∏: ${prefs.newLessons ? '‚úÖ' : '‚ùå'}\n- –û–Ω–æ–≤–ª–µ–Ω–Ω—è: ${prefs.updates ? '‚úÖ' : '‚ùå'}\n- –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: ${prefs.reminders ? '‚úÖ' : '‚ùå'}\n- –©–æ—Ç–∏–∂–Ω–µ–≤–∏–π –∑–≤—ñ—Ç: ${prefs.weekly ? '‚úÖ' : '‚ùå'}\n\n–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —Ü–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –∑–Ω–∞—á–∏—Ç—å email —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ!`
            })
        });
        
        if (response.ok) {
            showEmailStatus('‚úÖ –¢–µ—Å—Ç–æ–≤–∏–π email –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–≤–æ—é —Å–∫—Ä–∏–Ω—å–∫—É.', 'success');
        } else {
            throw new Error('Failed to send email');
        }
    } catch (error) {
        console.error('Email error:', error);
        showEmailStatus('‚ùå –ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è email', 'error');
    }
}

async function sendLessonCompletionEmail(lessonId) {
    if (!currentUser || !currentUser.emailPreferences?.newLessons) return;
    
    const lesson = lessons.find(l => l.id === lessonId);
    if (!lesson) return;
    
    const nextLesson = lessons.find(l => l.id === lessonId + 1);
    if (!nextLesson) return;
    
    try {
        await fetch(`${window.HATCH_CONFIG?.apiBaseUrl || ''}/services/send_email`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: currentUser.name,
                email: currentUser.email,
                message: `–í—ñ—Ç–∞—î–º–æ, ${currentUser.name}!\n\nüéâ –í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ "${lesson.title}"!\n\n–¢–µ–ø–µ—Ä –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞—Å—Ç—É–ø–Ω–∏–π —É—Ä–æ–∫:\n\nüìö "${nextLesson.title}"\n‚≠ê –ë–∞–ª–∏: ${nextLesson.points}\n‚è±Ô∏è –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: ${nextLesson.duration}\n\n–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å: ${completed.size}/16 —É—Ä–æ–∫—ñ–≤ (${Math.round((completed.size / 16) * 100)}%)\n–ó–∞–≥–∞–ª—å–Ω—ñ –±–∞–ª–∏: ${totalScore}\n\n–ü—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ –Ω–∞–≤—á–∞–Ω–Ω—è! üöÄ`
            })
        });
    } catch (error) {
        console.error('Email notification error:', error);
    }
}

window.saveEmailPreferences = saveEmailPreferences;
window.testEmailNotification = testEmailNotification;

async function checkCacheStatus() {
    if ('caches' in window) {
        try {
            const cacheNames = await caches.keys();
            const cache = await caches.open('parental-directives-v1');
            const cachedRequests = await cache.keys();
            
            let totalSize = 0;
            for (const request of cachedRequests) {
                const response = await cache.match(request);
                if (response) {
                    const blob = await response.blob();
                    totalSize += blob.size;
                }
            }
            
            const sizeInMB = (totalSize / (1024 * 1024)).toFixed(2);
            document.getElementById('cache-size').textContent = `~ ${sizeInMB} MB`;
            document.getElementById('cache-pages-status').innerHTML = `‚úÖ ${cachedRequests.length} —Å—Ç–æ—Ä—ñ–Ω–æ–∫`;
            
            alert(`üìä –°—Ç–∞—Ç—É—Å –æ—Ñ–ª–∞–π–Ω –∫–µ—à—É:\n\nüìÑ –°—Ç–æ—Ä—ñ–Ω–æ–∫: ${cachedRequests.length}\nüíæ –†–æ–∑–º—ñ—Ä: ${sizeInMB} MB\n\n–í—ñ–¥–µ–æ YouTube –Ω–µ –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –æ—Ñ–ª–∞–π–Ω.`);
        } catch (error) {
            console.error('Cache status error:', error);
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–µ—à—É');
        }
    } else {
        alert('‚ö†Ô∏è –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º');
    }
}

async function clearOfflineCache() {
    if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –æ—Ñ–ª–∞–π–Ω –∫–µ—à? –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –∫—É—Ä—Å –Ω–µ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –±–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.')) {
        return;
    }
    
    if ('caches' in window) {
        try {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
            
            document.getElementById('cache-size').textContent = '0 MB';
            document.getElementById('cache-pages-status').innerHTML = '‚ùå –û—á–∏—â–µ–Ω–æ';
            
            alert('‚úÖ –û—Ñ–ª–∞–π–Ω –∫–µ—à –æ—á–∏—â–µ–Ω–æ!\n\n–°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è...');
            setTimeout(() => location.reload(), 1000);
        } catch (error) {
            console.error('Cache clear error:', error);
            alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É');
        }
    } else {
        alert('‚ö†Ô∏è –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º');
    }
}

window.checkCacheStatus = checkCacheStatus;
window.clearOfflineCache = clearOfflineCache;

if ('serviceWorker' in navigator && currentScreen === 'workbook') {
    checkCacheStatus();
}
</script>

</body>
</html>